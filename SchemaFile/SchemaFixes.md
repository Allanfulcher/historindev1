-- 1) Drop foreign keys in children
alter table stories drop constraint if exists stories_rua_id_fkey;
alter table stories drop constraint if exists stories_org_id_fkey;
alter table streets drop constraint if exists streets_cidade_id_fkey;

-- 2) Rebuild primary keys as bigint identity (drop and recreate id columns)
-- Cities
alter table cities drop constraint if exists cities_pkey;
alter table cities drop column if exists id;
alter table cities add column id bigint generated by default as identity primary key;

-- Organizations
alter table organizations drop constraint if exists organizations_pkey;
alter table organizations drop column if exists id;
alter table organizations add column id bigint generated by default as identity primary key;

-- Streets
alter table streets drop constraint if exists streets_pkey;
alter table streets drop column if exists id;
alter table streets add column id bigint generated by default as identity primary key;

-- Stories
alter table stories drop constraint if exists stories_pkey;
alter table stories drop column if exists id;
alter table stories add column id bigint generated by default as identity primary key;

-- 3) Recreate child FK columns as bigint and add FKs back
-- streets.cidade_id
alter table streets drop column if exists cidade_id;
alter table streets add column cidade_id bigint;
alter table streets add constraint streets_cidade_id_fkey
  foreign key (cidade_id) references cities(id) on delete set null;

-- stories.rua_id
alter table stories drop column if exists rua_id;
alter table stories add column rua_id bigint;
alter table stories add constraint stories_rua_id_fkey
  foreign key (rua_id) references streets(id) on delete set null;

-- stories.org_id
alter table stories drop column if exists org_id;
alter table stories add column org_id bigint;
alter table stories add constraint stories_org_id_fkey
  foreign key (org_id) references organizations(id) on delete set null;

-- Businesses
alter table businesses drop constraint if exists cities_pkey;
alter table cities drop column if exists id;
alter table cities add column id bigint generated by default as identity primary key;

