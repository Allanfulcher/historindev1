-- Stories table
drop table if exists public.stories cascade;

-- Stories table (bigint ids, no UUIDs)
create table public.stories (
  id bigint primary key generated by default as identity,
  created_at timestamptz not null default now(),

  -- Foreign keys (all bigint)
  rua_id bigint null references public.streets(id) on delete set null,
  org_id bigint null references public.organizations(id) on delete set null,
  negocio_id bigint null references public.businesses(id) on delete set null,

  -- Content
  titulo text not null,
  descricao text not null,
  fotos text[] null,
  lat double precision null,
  lng double precision null,
  ano text null,
  criador text null,
  tags text[] null
);

-- Recommended indexes
create index if not exists idx_stories_titulo on public.stories using gin (to_tsvector('simple', coalesce(titulo, '')));
create index if not exists idx_stories_tags on public.stories using gin (tags);
create index if not exists idx_stories_rua_id on public.stories(rua_id);
create index if not exists idx_stories_org_id on public.stories(org_id);
create index if not exists idx_stories_negocio_id on public.stories(negocio_id);
