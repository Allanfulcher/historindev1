<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historin - Histórias das cidades</title>
    <meta name="theme-color" content="#E6D3B4">
    <link rel="icon" type="image/png" sizes="512x512" href="fotos/icons/historin-logo-512.png" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Historin">
    <link rel="apple-touch-icon" sizes="512x512" href="fotos/icons/historin-logo-512.png">

    <!-- Banco de Dados -->
    <script src="bd.js" defer></script>
    <!-- Bibliotecas e estilos externos -->
    <!-- React e ReactDOM -->
    <script src="https://unpkg.com/react@17/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js" crossorigin></script>

    <link rel="manifest" href="manifest.json">


    <!-- React Router DOM -->
    <script src="libs/react-router-dom.min.js" crossorigin></script>

    <!-- Babel para JSX -->
    <script src="libs/babel.min.js" defer></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Merriweather:wght@400;700&family=Inter:wght@400;600&display=swap"
        rel="stylesheet">

    <!-- Font Awesome (versão 6.6.0 para consistência) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="libs/leaflet.css" />

    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="styles3.5.css" />
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6RZP5DGP0E"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-6RZP5DGP0E', { 'send_page_view': false });
    </script>

</head>

<body>

    <div id="loading">
        <div class="spinner"></div>
        <div class="messages"></div>
    </div>

    <script>
        // Lista de mensagens
        const messages = [
            "Estamos buscando histórias no passado",
            "Adaptando o antigo ao novo",
            "Preparando uma experiência de imersão",
            "Revivendo as histórias que moldaram nossa cidade...",
            "Aguarde enquanto trazemos o passado para o presente!",
            "Conectando gerações por meio das memórias...",
            "Desvendando segredos das ruas que você percorre.",
            "Carregando histórias para enriquecer sua caminhada.",
            "Embarque em uma jornada pelo tempo...",
            "Cada rua tem um conto, descubra o seu agora!",
            "Histórias locais, memórias eternas...",
            "Do passado ao futuro, em segundos!",
            "As ruas sussurram histórias... ouça enquanto carregamos.",
            "Explorando o coração histórico de Gramado.",
            "Memórias ganhando vida, aguarde um instante!",
            "Do QR code à história viva em um piscar de olhos.",
            "Enriquecendo sua jornada com relatos inesquecíveis...",
            "Porque cada esquina guarda um pedaço da história."
        ];

        // Função para embaralhar a lista de mensagens
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Embaralha as mensagens
        shuffle(messages);

        const messagesContainer = document.querySelector('#loading .messages');
        let currentMessageIndex = 0;

        // Função para exibir a próxima mensagem
        function showNextMessage() {
            // Cria o elemento da mensagem
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            messageElement.textContent = messages[currentMessageIndex];

            // Adiciona a mensagem ao DOM
            messagesContainer.innerHTML = '';
            messagesContainer.appendChild(messageElement);

            // Avança para a próxima mensagem
            currentMessageIndex = (currentMessageIndex + 1) % messages.length;

            // Atualiza a mensagem após 3 segundos
            setTimeout(showNextMessage, 3000);
        }

        // Inicia o ciclo de mensagens
        showNextMessage();

        // Remove a barra de carregamento após a página ser carregada
        window.addEventListener('load', () => {
            const loader = document.getElementById('loading');
            if (loader) {
                loader.style.opacity = '0';
                setTimeout(() => loader.remove(), 500); // Remove o elemento após a transição
            }
        });
    </script>



    <div id="root"></div>

    <!-- Bibliotecas externas -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <!-- Script principal -->
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const { HashRouter, Switch, Route, Link, useParams, useHistory, useLocation } = window.ReactRouterDOM;

        // Função para verificar se o popup deve ser exibido
        const shouldShowPopup = () => {
            const lastShown = localStorage.getItem('popupLastShown');
            const now = new Date().getTime();
            const showInterval = 1 * 24 * 60 * 60 * 1000; // Exibir a cada 1 dia
            if (!lastShown || now - lastShown > showInterval) {
                localStorage.setItem('popupLastShown', now);
                return true;
            }
            return false;
        };

        // Novo Componente OnboardingPopup com Barra de Carregamento e Botão "Começar"
        const OnboardingPopup = ({ onClose }) => {
            const [step, setStep] = useState(0);
            const totalSteps = 3;

            const handleNext = () => {
                if (step < totalSteps - 1) {
                    setStep(step + 1);
                }
            };

            const handleSkip = () => {
                setStep(totalSteps - 1);
            };

            return (
                <div className="z-high fixed inset-0 flex items-center justify-center bg-black bg-opacity-75">
                    <div
                        className="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative flex flex-col items-center"
                        style={{
                            maxHeight: '90vh', // Limitar altura máxima a 90% da altura da tela
                            overflowY: 'auto', // Permitir rolagem se o conteúdo ultrapassar o limite
                        }}
                    >
                        {/* Conteúdo do Onboarding baseado na Home */}
                        <div className="introduction p-4">
                            <h2>Bem-vindo ao Historin!</h2>
                            <div className="steps">
                                {step === 0 && (
                                    <div className="step">
                                        <span className="step-number">1</span>
                                        <p>Explore histórias pela geografia e descubra a história por trás dos lugares!</p>
                                    </div>
                                )}
                                {step === 1 && (
                                    <div className="step">
                                        <span className="step-number">2</span>
                                        <p>Navegue pela linha do tempo para reviver os eventos que moldaram nossa cidade!</p>
                                    </div>
                                )}
                                {step === 2 && (
                                    <div className="step">
                                        <span className="step-number">3</span>
                                        <p>Contribua com suas histórias e experiências e aproveite a jornada!</p>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Botão de Avançar */}
                        {step < totalSteps - 1 && (
                            <button
                                className="bg-blue-500 text-white px-6 py-2 rounded-md mb-4 hover:bg-blue-600 transition"
                                onClick={handleNext}
                                aria-label="Avançar"
                            >
                                Avançar
                            </button>
                        )}

                        {/* Botão "Começar" */}
                        {step === totalSteps - 1 && (
                            <button
                                className="bg-green-500 text-white px-6 py-2 rounded-md mb-4 hover:bg-green-600 transition"
                                onClick={onClose}
                                aria-label="Começar"
                            >
                                Começar
                            </button>
                        )}

                        {/* Botão de Pular */}
                        {step < totalSteps - 1 && (
                            <button
                                className="text-gray-600 underline mb-4 hover:text-gray-800 transition"
                                onClick={handleSkip}
                                aria-label="Pular"
                            >
                                Pular
                            </button>
                        )}

                        {/* Botão de Fechar */}
                        <button
                            className={`absolute top-2 right-2 text-gray-600 cursor-pointer`}
                            onClick={onClose}
                            aria-label="Fechar onboarding"
                        >
                            <i className="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
            );
        };





        // Novo Componente DonationPopup
        const DonationPopup = ({ onClose }) => {
            return (
                <div className="z-high fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
                    <div className="bg-white rounded-lg shadow-lg max-w-sm w-full p-6 relative">
                        <button
                            className="absolute top-2 right-2 text-gray-600 hover:text-gray-800"
                            onClick={onClose}
                            aria-label="Fechar doação"
                        >
                            <i className="fas fa-times text-xl"></i>
                        </button>
                        <h3 className="text-xl font-bold mb-4 text-center">Gostou do Historin?</h3>
                        <p className="text-center mb-4">Apoie o projeto e ajude a cobrir os custos mensais!</p>
                        <div className="flex justify-center">
                            <Link
                                to="/sobre#doacao"
                                className="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition"
                                onClick={onClose}
                            >
                                Doar Agora
                            </Link>
                        </div>
                    </div>
                </div>
            );
        };


        // Componente de Modal de Dados (DataModal)
        const DataModal = ({ isOpen, onClose, title, data, columns }) => {
            if (!isOpen) return null;

            return (
                <div
                    className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
                    onClick={onClose}
                >
                    <div
                        className="bg-white rounded-lg shadow-lg max-w-lg w-full p-6 relative"
                        onClick={(e) => e.stopPropagation()}
                    >
                        <button
                            className="absolute top-4 right-4 text-gray-600 hover:text-gray-800"
                            onClick={onClose}
                            aria-label="Fechar modal"
                        >
                            <i className="fas fa-times text-xl"></i>
                        </button>
                        <h3 className="text-xl font-bold mb-4 text-center">{title}</h3>
                        <div className="max-h-64 overflow-y-auto">
                            <ul>
                                {data.map((item, index) => (
                                    <li key={index} className="flex justify-between items-center py-2 border-b">
                                        {columns.map((column, colIndex) => (
                                            <span key={colIndex} className="w-1/2">{item[column.accessor]}</span>
                                        ))}
                                    </li>
                                ))}
                            </ul>
                        </div>
                        <div className="mt-4 text-center">
                            <p className="text-gray-500">Total de {title.toLowerCase()}: <span className="font-bold">{data.length}</span></p>
                        </div>
                    </div>
                </div>
            );
        };

        // Componente do Popup Carrossel
        const PopupCarrossel = ({ onClose }) => {
            const [currentSlide, setCurrentSlide] = useState(0);
            const slides = [
                { image: 'fotos/criadores-historin-gramado.jpeg', text: 'Conheça mais sobre nós', buttonText: 'Ver agora', link: '/sobre' },
                { image: 'fotos/legado-africano-gramado.png', text: 'Conheça o legado africano em Gramado', buttonText: 'Saiba Mais!', link: '/legado-africano' },
                { image: 'fotos/comprar-ingressos.png', text: 'Ingressos para essa semana em Promoção', buttonText: 'Comprar agora', link: 'https://parksnet.com.br/ingressos/?bookingAgency=2818' }
            ];

            const nextSlide = () => setCurrentSlide((prev) => (prev + 1) % slides.length);
            const prevSlide = () => setCurrentSlide((prev) => (prev - 1 + slides.length) % slides.length);

            const handleOverlayClick = (e) => {
                if (e.target === e.currentTarget) {
                    onClose();
                }
            };

            return (
                <div
                    className="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center fade-in z-high"
                    onClick={handleOverlayClick}
                >
                    <div className="bg-white rounded-lg shadow-lg p-6 w-11/12 max-w-2xl relative">
                        <button onClick={onClose} className="absolute top-2 right-2 text-gray-600 hover:text-gray-800">
                            <i className="fas fa-times text-xl"></i>
                        </button>

                        <div className="text-center">
                            <img src={slides[currentSlide].image} alt={`Slide ${currentSlide + 1}`} className="rounded-lg mb-4 w-full object-cover h-64" />
                            <p className="text-lg font-semibold mb-4">{slides[currentSlide].text}</p>
                            <Link
                                to={slides[currentSlide].link}
                                className="bg-blue-500 text-white px-6 py-3 rounded-md hover:bg-blue-600 transition"
                                onClick={onClose} // Fecha o popup ao clicar no botão
                            >
                                {slides[currentSlide].buttonText}
                            </Link>
                        </div>

                        <div className="flex justify-between items-center mt-4">
                            <button
                                onClick={prevSlide}
                                className="px-4 py-2 bg-gray-300 rounded-full hover:bg-gray-400 transition flex items-center justify-center w-12 h-12"
                            >
                                <i className="fas fa-chevron-left text-black text-2xl"></i>
                            </button>
                            <button
                                onClick={nextSlide}
                                className="px-4 py-2 bg-gray-300 rounded-full hover:bg-gray-400 transition flex items-center justify-center w-12 h-12"
                            >
                                <i className="fas fa-chevron-right text-black text-2xl"></i>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };


        const QuizModal = ({
            isOpen,
            onClose,
            email,
            setEmail,
            emailSubmitted,
            setEmailSubmitted,
            quizStarted,
            setQuizStarted,
        }) => {
            const [score, setScore] = useState(0);
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [answersDisabled, setAnswersDisabled] = useState(false);
            const [selectedAnswerIndex, setSelectedAnswerIndex] = useState(null);
            const [showFeedback, setShowFeedback] = useState(false);
            const [feedbackMessage, setFeedbackMessage] = useState('');
            const [scoresList, setScoresList] = useState([]);
            const [isCorrect, setIsCorrect] = useState(null);
            const [selectedQuestions, setSelectedQuestions] = useState([]);

            // Função para obter 10 perguntas aleatórias
            function getRandomQuestions(allQuestions, num) {
                const shuffled = [...allQuestions].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, num);
            }

            // Salvar progresso no localStorage
            const saveProgress = () => {
                const quizData = {
                    email,
                    emailSubmitted,
                    quizStarted,
                    score,
                    currentQuestion,
                    selectedAnswerIndex,
                    answersDisabled,
                    showFeedback,
                    feedbackMessage,
                    isCorrect,
                    selectedQuestions,
                };
                localStorage.setItem('quizProgress', JSON.stringify(quizData));
            };

            // Carregar progresso do localStorage
            const loadProgress = () => {
                const savedData = JSON.parse(localStorage.getItem('quizProgress'));
                if (savedData) {
                    setEmail(savedData.email || '');
                    setEmailSubmitted(savedData.emailSubmitted || false);
                    setQuizStarted(savedData.quizStarted || false);
                    setScore(savedData.score || 0);
                    setCurrentQuestion(savedData.currentQuestion || 0);
                    setSelectedAnswerIndex(
                        savedData.selectedAnswerIndex !== null ? savedData.selectedAnswerIndex : null
                    );
                    setAnswersDisabled(savedData.answersDisabled || false);
                    setShowFeedback(savedData.showFeedback || false);
                    setFeedbackMessage(savedData.feedbackMessage || '');
                    setIsCorrect(savedData.isCorrect);
                    setSelectedQuestions(savedData.selectedQuestions || []);
                }
            };

            // Carregar progresso quando o componente é montado
            useEffect(() => {
                if (isOpen) {
                    loadProgress();
                }
            }, [isOpen]);

            // Salvar progresso sempre que o estado relevante mudar
            useEffect(() => {
                if (quizStarted) saveProgress();
            }, [
                quizStarted,
                currentQuestion,
                score,
                selectedAnswerIndex,
                answersDisabled,
                showFeedback,
                feedbackMessage,
                isCorrect,
                selectedQuestions,
            ]);

            const handleEmailSubmit = (e) => {
                e.preventDefault();
                // Enviar email via Formspree
                fetch('https://formspree.io/f/xpwzrpvj', {
                    method: 'POST',
                    headers: {
                        Accept: 'application/json',
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: email,
                    }),
                })
                    .then((response) => {
                        if (response.ok) {
                            // Email enviado com sucesso
                            setEmailSubmitted(true);
                            setQuizStarted(true);
                            setSelectedQuestions(getRandomQuestions(questions, 10));
                        } else {
                            // Lidar com erro
                            console.error('Falha ao enviar email');
                        }
                    })
                    .catch((error) => {
                        console.error('Erro ao enviar email:', error);
                    });
            };

            const handleAnswer = (index) => {
                if (answersDisabled) return;
                setAnswersDisabled(true);
                setSelectedAnswerIndex(index);
                const correctIndex = selectedQuestions[currentQuestion]?.correct;
                const isCorrect = index === correctIndex;
                setIsCorrect(isCorrect);
                if (isCorrect) {
                    setScore(score + 10);
                    setFeedbackMessage('Correto!');
                } else {
                    setFeedbackMessage('Incorreto!');
                }
                setShowFeedback(true);
                setTimeout(() => {
                    setShowFeedback(false);
                    setSelectedAnswerIndex(null);
                    setCurrentQuestion(currentQuestion + 1);
                    setAnswersDisabled(false);
                    setIsCorrect(null);
                }, 1000);
            };

            const handleClose = () => {
                saveProgress();
                onClose();
            };

            // Salvar pontuação e finalizar quiz quando todas as perguntas forem respondidas
            useEffect(() => {
                if (selectedQuestions.length > 0 && currentQuestion >= selectedQuestions.length) {
                    const storedScores = JSON.parse(localStorage.getItem('scoresList')) || [];
                    const newScores = [...storedScores, { email, score }];
                    localStorage.setItem('scoresList', JSON.stringify(newScores));
                    setScoresList(newScores);

                    // Resetar estado do quiz
                    setQuizStarted(false);
                }
            }, [currentQuestion]);

            // Iniciar quiz se o email já foi enviado
            useEffect(() => {
                if (emailSubmitted && !quizStarted) {
                    setQuizStarted(true);
                    setSelectedQuestions(getRandomQuestions(questions, 10));
                }
            }, [emailSubmitted, quizStarted]);

            return isOpen ? (
                <div
                    className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
                    onClick={handleClose}
                >
                    <div
                        className="bg-white p-6 rounded-lg shadow-lg max-w-lg w-full"
                        onClick={(e) => e.stopPropagation()}
                    >
                        {quizStarted || (!quizStarted && emailSubmitted) ? (
                            selectedQuestions[currentQuestion] ? (
                                <div>
                                    <div className="flex justify-between items-center mb-4">
                                        <span className="text-lg font-semibold">
                                            Pergunta {currentQuestion + 1} de {selectedQuestions.length}
                                        </span>
                                    </div>
                                    <p className="text-lg font-semibold mb-4">
                                        {selectedQuestions[currentQuestion].question}
                                    </p>
                                    {selectedQuestions[currentQuestion].answers.map((answer, idx) => (
                                        <button
                                            key={idx}
                                            onClick={() => handleAnswer(idx)}
                                            className={`w-full py-2 mb-2 rounded-lg
                                        ${answersDisabled
                                                    ? idx === selectedQuestions[currentQuestion].correct
                                                        ? 'bg-green-500 text-white'
                                                        : idx === selectedAnswerIndex
                                                            ? 'bg-red-500 text-white'
                                                            : 'bg-gray-200'
                                                    : 'bg-blue-500 text-white hover:bg-blue-600'
                                                }
                                    `}
                                            disabled={answersDisabled}
                                        >
                                            {answer}
                                        </button>
                                    ))}
                                    {showFeedback && (
                                        <p
                                            className={`text-center text-lg font-bold mt-4 ${isCorrect ? 'text-green-500' : 'text-red-500'
                                                }`}
                                        >
                                            {feedbackMessage}
                                        </p>
                                    )}
                                </div>
                            ) : (
                                <div className="text-center">
                                    <p className="text-2xl font-semibold mb-4">Quiz finalizado!</p>
                                    <p className="text-lg font-semibold mb-2">Email: {email}</p>
                                    {(() => {
                                        const totalScore = selectedQuestions.length * 10;
                                        const percentageScore = Math.round((score / totalScore) * 100);
                                        return (
                                            <p className="text-lg font-semibold mb-4">
                                                Sua pontuação é {percentageScore}%
                                            </p>
                                        );
                                    })()}
                                    <h3 className="text-xl font-bold mb-2">Ranking:</h3>
                                    <ul className="mb-4">
                                        {scoresList
                                            .sort((a, b) => b.score - a.score)
                                            .slice(0, 5) // Top 5
                                            .map((item, idx) => {
                                                const totalScore = selectedQuestions.length * 10;
                                                const percentageScore = Math.round(
                                                    (item.score / totalScore) * 100
                                                );
                                                return (
                                                    <li
                                                        key={idx}
                                                        className="flex justify-between items-center py-2 px-4 bg-gray-100 rounded-lg mb-2"
                                                    >
                                                        <span>
                                                            {idx + 1}. {item.email}
                                                        </span>
                                                        <span>{percentageScore}%</span>
                                                    </li>
                                                );
                                            })}
                                    </ul>
                                    <button
                                        onClick={() => {
                                            // Reiniciar quiz sem pedir email novamente
                                            setScore(0);
                                            setCurrentQuestion(0);
                                            setQuizStarted(true);
                                            setSelectedQuestions(getRandomQuestions(questions, 10));
                                        }}
                                        className="py-2 mb-2 bg-green-500 text-white rounded-lg mx-auto block w-full hover:bg-green-600"
                                    >
                                        Tentar novamente
                                    </button>
                                </div>
                            )
                        ) : !emailSubmitted ? (
                            <div>
                                <p className="text-lg font-semibold mb-4">
                                    Teste seus conhecimentos sobre a plataforma.
                                </p>
                                <form onSubmit={handleEmailSubmit} className="flex flex-col">
                                    <label className="mb-2 text-lg font-semibold">
                                        Digite seu email para começar:
                                    </label>
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        required
                                        className="mb-4 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                    <button
                                        type="submit"
                                        className="py-2 bg-green-500 text-white rounded-lg hover:bg-green-600"
                                    >
                                        Começar Quiz
                                    </button>
                                </form>
                            </div>
                        ) : (
                            <div>
                                {/* Carregando ou mensagem */}
                            </div>
                        )}
                        <button
                            onClick={handleClose}
                            className="mt-4 text-red-500 hover:text-red-600"
                        >
                            Fechar
                        </button>
                    </div>
                </div>
            ) : null;
        };
        const Header = ({ setMenuOpen, setShowFeedback }) => {
            const [showQuiz, setShowQuiz] = useState(false);
            const [email, setEmail] = useState('');
            const [emailSubmitted, setEmailSubmitted] = useState(false);
            const [quizStarted, setQuizStarted] = useState(false);

            // Função para compartilhar
            const handleShare = () => {
                if (navigator.share) {
                    navigator
                        .share({
                            title: 'Historin - Histórias de Gramado',
                            text: 'Descubra as histórias de Gramado através do Historin!',
                            url: window.location.href,
                        })
                        .catch((error) => console.error('Erro ao compartilhar:', error));
                } else {
                    alert('Compartilhamento não suportado neste navegador.');
                }
            };

            const buttonStyle =
                'px-4 py-2 bg-blue-500 text-white rounded-lg cursor-pointer hover:bg-blue-600';

            return (
                <header className="flex justify-between items-center p-4 bg-[#E6D3B4]">
                    <div className="flex items-center">
                        <Link to="/" className="mr-2">
                            <img src="fotos/historin-logo.svg" alt="HISTORIN Logo" className="text-2xl font-bold logo" />
                        </Link>
                    </div>

                    <div className="flex items-center space-x-4">
                        <button
                            onClick={() => setShowQuiz(true)}
                            className={`${buttonStyle} flex items-center`}
                        >
                            <i className="fas fa-question-circle mr-2"></i>
                            Quiz
                        </button>

                        <QuizModal
                            isOpen={showQuiz}
                            onClose={() => setShowQuiz(false)}
                            email={email}
                            setEmail={setEmail}
                            emailSubmitted={emailSubmitted}
                            setEmailSubmitted={setEmailSubmitted}
                            quizStarted={quizStarted}
                            setQuizStarted={setQuizStarted}
                        />

                        {/* Botão Compartilhar */}
                        <button
                            onClick={handleShare}
                            aria-label="Compartilhar"
                            className="text-2xl pr-2 hover:text-blue-600"
                        >
                            <i className="fas fa-share-alt"></i>
                        </button>

                        {/* Botão Feedback */}
                        <button
                            onClick={() => setShowFeedback(true)}
                            aria-label="Feedback"
                            className="text-2xl pr-2 hover:text-blue-600"
                        >
                            <i className="fas fa-comment-dots"></i>
                        </button>

                        {/* Botão Menu */}
                        <div
                            className="text-2xl cursor-pointer hover:text-blue-600"
                            onClick={() => setMenuOpen(true)}
                        >
                            <i className="fas fa-bars"></i>
                        </div>
                    </div>
                </header>
            );
        };










        // Menu Lateral
        const Menu = ({ menuOpen, setMenuOpen, setShowMap }) => {
            const history = useHistory();

            const handleSurpriseMe = () => {
                if (historias && historias.length > 0) {
                    const randomHistoria = historias[Math.floor(Math.random() * historias.length)];
                    history.push(`/rua/${randomHistoria.rua_id}/historia/${randomHistoria.id}`);
                    setMenuOpen(false);
                } else {
                    alert('Nenhuma história disponível.');
                }
            };


            return (
                <>
                    {/* Overlay do Menu */}
                    <div
                        className={`menu-overlay ${menuOpen ? 'open' : ''}`}
                        onClick={() => setMenuOpen(false)}
                    ></div>

                    {/* Navegação do Menu */}
                    <nav className={`menu ${menuOpen ? 'open' : ''}`}>
                        {/* Cabeçalho do Menu */}
                        <div className="menu-header text-center mt-8 px-6">
                            <h2 className="text-3xl font-serif font-bold">Menu</h2>
                        </div>

                        {/* Itens do Menu */}
                        <div className="flex flex-col flex-grow mt-8 px-6">
                            <Link
                                to="/"
                                className="menu-item px-4 py-3 hover:bg-gray-100 rounded-md"
                                onClick={() => { setShowMap(true); setMenuOpen(false); }}
                            >
                                <span className="block text-lg font-semibold">ÍNICIO</span>
                                <span className="subtitle block text-sm text-gray-500">e MAPA</span>
                            </Link>
                            <Link
                                to="/adicionar-historia"
                                className="menu-item px-4 py-3 hover:bg-gray-100 rounded-md"
                                onClick={() => setMenuOpen(false)}
                            >
                                <span className="subtitle block text-sm text-gray-500">Conte a sua</span>
                                <span className="block text-lg font-semibold">HISTÓRIA</span>
                            </Link>

                            <Link
                                to="/ruas-e-historias"
                                className="menu-item px-4 py-3 hover:bg-gray-100 rounded-md text-lg font-semibold"
                                onClick={() => setMenuOpen(false)}
                            >
                                TODAS
                                <span className="subtitle block text-sm text-gray-500">Ruas e Histórias</span>

                            </Link>
                            <Link
                                to="/sobre"
                                className="menu-item px-4 py-3 hover:bg-gray-100 rounded-md text-lg font-semibold"
                                onClick={() => setMenuOpen(false)}
                            >
                                SOBRE
                            </Link>

                            <Link
                                to="/legado-africano"
                                className="menu-item px-4 py-3 hover:bg-gray-100 rounded-md text-lg font-semibold"
                                onClick={() => setMenuOpen(false)}
                            >
                                Legado Afro no RS
                            </Link>
                            <Link
                                to="/referencias"
                                className="menu-item px-4 py-3 bg-transparent hover:bg-gray-100 rounded-md text-lg font-semibold"
                                onClick={() => setMenuOpen(false)}
                            >
                                REFERÊNCIAS
                                <span className="subtitle block text-sm text-gray-500">+ conteúdo</span>

                            </Link>

                        </div>

                        {/* Rodapé do Menu */}
                        <div className="menu-footer px-6 pb-6">
                            {/* Imagem do Rodapé */}
                            <img
                                src="https://i.postimg.cc/8C184M44/parks-net.png"
                                alt="Banner"
                                className="mb-4 w-full h-48 object-cover rounded-md"
                            />

                            {/* Botão Compre Seus Ingressos */}
                            <a
                                href="https://parksnet.com.br/ingressos/?bookingAgency=2818"
                                target="_blank"
                                rel="noopener noreferrer"
                                className="button bg-blue-500 text-white px-4 py-2 rounded-md mb-2 block text-center"
                            >
                                Compre seus ingressos
                            </a>

                            {/* Texto de Rodapé */}
                            <div className="footer-text text-center text-sm text-gray-600 mt-4">
                                Criado em Gramado
                            </div>
                        </div>
                    </nav>
                </>
            );
        };

        // Página Sobre (Atualizada)
        const Sobre = () => {

            const location = useLocation();
            useEffect(() => {
                if (location.hash === "#doacao") {
                    const donationSection = document.getElementById("doacao");
                    if (donationSection) {
                        donationSection.scrollIntoView({ behavior: "smooth" });
                    }
                }
            }, [location]);

            useEffect(() => {
                document.title = "Sobre Nós - Historin";

                // Update the meta description
                let metaDescription = document.querySelector('meta[name="description"]');
                if (metaDescription) {
                    metaDescription.setAttribute('content', 'Saiba mais sobre o Historin, nossa visão, equipe e como você pode contribuir.');
                } else {
                    metaDescription = document.createElement('meta');
                    metaDescription.name = "description";
                    metaDescription.content = 'Saiba mais sobre o Historin, nossa visão, equipe e como você pode contribuir.';
                    document.head.appendChild(metaDescription);
                }
            }, []);

            const [selectedMember, setSelectedMember] = useState(null);
            const [showJoinModal, setShowJoinModal] = useState(false); // Novo estado para o modal

            const teamMembers = [
                {
                    name: 'Allan Fulcher',
                    role: 'Fundador',
                    description: `Allan Fulcher, fundador do Historin, é um empreendedor dinâmico com uma visão inovadora. Com experiência em múltiplos segmentos de negócios e uma profunda conexão com a cidade de Gramado, Allan acredita que a história deve ser preservada e contada de maneira acessível a todos. Com sua expertise em tecnologia e marketing, ele idealizou o Historin como uma maneira de imortalizar as histórias que moldaram a cidade, trazendo-as para o mundo digital.`,
                },
                {
                    name: 'Mateus Canova',
                    role: 'Co-fundador',
                    description: `Mateus Canova, co-fundador do projeto, é um estrategista de marketing com uma mente criativa, responsável por trazer inovação e dinamismo ao Historin. Com uma vasta experiência em comunicação digital, Mateus está focado em conectar pessoas e histórias de uma forma única. Sua paixão por soluções visuais e narrativas envolventes é o que torna o Historin uma experiência não só informativa, mas também emocional para seus usuários.`,
                },
                // Adicione mais membros conforme necessário
            ];


            return (
                <div className="p-4 w-full lg:w-4/5">
                    {/* Cabeçalho */}
                    <header className="flex justify-between items-center mb-4">
                        <div className="text-2xl cursor-pointer">
                            <Link to="/">
                                <i className="fas fa-arrow-left"></i>
                            </Link>
                        </div>
                        <h1 className="text-lg font-bold">Sobre Nós</h1>
                        <div className="w-10 h-10"></div>
                    </header>

                    {/* Seção Sobre Nós */}
                    <section className="mb-6">
                        <h2 className="text-center text-2xl font-bold mb-4">Sobre Nós</h2>
                        <p className="text-justify">
                            O Historin nasceu da paixão pela história, pela inovação e pelo desejo de conectar passado e presente de maneira interativa. Somos um projeto incubado na Secretaria de Cultura de Gramado, desenvolvido para preservar as memórias da cidade através de uma plataforma acessível e inovadora.
                        </p>
                    </section>

                    {/* Espaço para o Vídeo do YouTube */}
                    <section className="mb-6">
                        <div className="video-container mb-4">
                            <iframe
                                width="100%"
                                height="215"
                                src="https://www.youtube.com/embed/1_oyH5Af9fk"
                                title="YouTube video player"
                                frameBorder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowFullScreen
                                className="rounded-lg shadow-md"
                            ></iframe>
                        </div>
                    </section>

                    {/* Seção Quem Somos */}
                    <section className="mb-6">
                        <h2 className="text-center text-2xl font-bold mb-4">Quem Somos</h2>
                        <p className="text-justify mb-4">
                            Allan Fulcher e Mateus Canova, dois empreendedores apaixonados por tecnologia, inovação e desenvolvimento local, são os responsáveis pela criação do Historin.
                        </p>
                    </section>

                    {/* Seção Criação e Curadoria */}
                    <section className="mb-6">
                        <h3 className="text-center text-xl font-bold mb-4">Criação e Curadoria</h3>
                        <div className="space-y-2">
                            {teamMembers.map((member, index) => (
                                <button
                                    key={index}
                                    className={`w-full py-2 px-4 rounded-full focus:outline-none flex justify-between items-center transition-colors duration-300 ${selectedMember === member ? 'bg-[#8A5A44] text-white' : 'bg-gray-200 text-black'
                                        }`}
                                    onClick={() => setSelectedMember(selectedMember === member ? null : member)}
                                >
                                    <span>{member.name}</span>
                                    {/* Ícone da seta que muda de direção */}
                                    <i
                                        className={`fas ${selectedMember === member ? 'fa-chevron-up' : 'fa-chevron-down'
                                            } transition-transform duration-300`}
                                    ></i>
                                </button>
                            ))}
                        </div>
                        {/* Exibe a descrição do membro selecionado */}
                        {selectedMember && (
                            <div className="mt-4 border border-black p-4 rounded-md bg-[#f5f1e8]">
                                <h4 className="text-xl font-bold mb-2">{selectedMember.name}</h4>
                                <p className="text-sm text-gray-600 mb-2">{selectedMember.role}</p>
                                <p>{selectedMember.description}</p>
                            </div>
                        )}
                    </section>

                    {/* Seção Precisamos de Ajuda / Cadastre-se */}
                    <section className="mb-6">
                        <h3 className="text-center text-xl font-bold mb-4">Precisamos de Ajuda</h3>
                        <p className="text-center text-gray-700 mb-4">
                            Estamos sempre em busca de pessoas apaixonadas por história, tecnologia e inovação para se juntarem ao nosso time. Se você deseja contribuir com o Historin, inscreva-se abaixo!
                        </p>
                        <div className="flex justify-center">
                            <button
                                onClick={() => setShowJoinModal(true)}
                                className="bg-[#8A5A44] text-white px-6 py-3 rounded-md hover:bg-[#5a3e2e] transition"
                            >
                                Cadastre-se
                            </button>
                        </div>
                    </section>

                    {/* Modal de Inscrição */}
                    {showJoinModal && (
                        <div className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
                            <div
                                className="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative"
                                onClick={(e) => e.stopPropagation()} // Evita fechar ao clicar dentro do modal
                            >
                                {/* Botão de Fechar */}
                                <button
                                    className="absolute top-2 right-2 text-gray-600 hover:text-gray-800"
                                    onClick={() => setShowJoinModal(false)}
                                    aria-label="Fechar formulário"
                                >
                                    <i className="fas fa-times text-xl"></i>
                                </button>
                                <h3 className="text-xl font-bold mb-4 text-center">Junte-se ao Historin</h3>
                                <form
                                    action="https://formspree.io/f/xvgopalo" // Substitua pelo seu endpoint do Formspree
                                    method="POST"
                                >
                                    <div className="mb-4">
                                        <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="nome">
                                            Nome:
                                        </label>
                                        <input
                                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                            id="nome"
                                            type="text"
                                            name="nome"
                                            placeholder="Seu nome"
                                            required
                                        />
                                    </div>
                                    <div className="mb-4">
                                        <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="email">
                                            E-mail:
                                        </label>
                                        <input
                                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                            id="email"
                                            type="email"
                                            name="email"
                                            placeholder="Seu e-mail"
                                            required
                                        />
                                    </div>
                                    <div className="mb-4">
                                        <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="cargo">
                                            Cargo de Interesse:
                                        </label>
                                        <input
                                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                            id="cargo"
                                            type="text"
                                            name="cargo"
                                            placeholder="Qual posição você deseja ocupar?"
                                            required
                                        />
                                    </div>
                                    <div className="mb-4">
                                        <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="mensagem">
                                            Mensagem:
                                        </label>
                                        <textarea
                                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                            id="mensagem"
                                            name="mensagem"
                                            rows="4"
                                            placeholder="Por que você quer se juntar ao Historin?"
                                            required
                                        ></textarea>
                                    </div>
                                    <div className="flex items-center justify-center">
                                        <button
                                            type="submit"
                                            className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                                        >
                                            Enviar
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Seção Nossa Visão */}
                    <section className="mb-6">
                        <h2 className="text-center text-2xl font-bold mb-4">Nossa Visão</h2>
                        <p className="text-justify">
                            Queremos que o Historin seja mais do que um repositório de histórias. Nossa visão é que a plataforma seja uma ferramenta de aprendizado, inspiração e conexão. Acreditamos que ao contar as histórias de Gramado, desde os pioneiros até os dias atuais, podemos fortalecer a identidade local e conectar gerações de uma forma envolvente, usando tecnologias como QR codes e Realidade Aumentada para proporcionar uma "viagem no tempo".
                        </p>
                        <p className="text-justify mt-2">
                            Nosso compromisso é com a valorização da história e da cultura local, criando experiências que inspirem tanto moradores quanto turistas a explorar as ruas de Gramado de um jeito novo e interativo.
                        </p>
                    </section>

                    {/* Seção Onde Estamos */}
                    <section className="mb-6">
                        <h2 className="text-center text-2xl font-bold mb-4">Onde Estamos</h2>
                        <p className="text-justify">
                            O projeto é incubado na Vila Joaquina, em parceria com a Secretaria de Cultura de Gramado, e estamos sempre trabalhando para expandir nossas iniciativas, incorporando novas histórias e novos olhares sobre o que faz de Gramado uma cidade tão única.
                        </p>
                    </section>

                    {/* Seção Apoio e Patrocínio */}
                    <section className="mb-6">
                        <h3 className="text-center text-xl font-bold mb-4">Apoio e Patrocínio</h3>

                        {/* Grid de 2 colunas */}
                        <div className="grid grid-cols-2 gap-4 mb-4">

                            <div className="text-center">
                                <img
                                    src="https://gramado.atende.net/static/portal/img/2024/08/30/img_79375C9ED9F9C9774D60D45812CF5EEEEBDB33F1.png"
                                    alt="Prefeitura de Gramado"
                                    className="mx-auto mb-1 h-12 w-auto"
                                />
                                <p className="text-sm">Prefeitura de Gramado</p>
                            </div>

                            <div className="text-center">
                                <img
                                    src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSiUtFDFGcK3PvoitnOMwfhL_eXzF7ihu9Q_Q&s"
                                    alt="Feevale"
                                    className="mx-auto mb-1 h-12 w-auto"
                                />
                                <p className="text-sm">Feevale</p>
                            </div>

                                                        <div className="text-center">
                                <img
                                    src="fotos/orgs/logo-mundo-vapor.png"
                                    alt="Mundo a Vapor"
                                    className="mx-auto mb-1 h-12 w-auto"
                                />
                                <p className="text-sm">Mundo a Vapor</p>
                            </div>
                            {/* Adicione mais logos ou itens aqui se necessário */}
                        </div>
                    </section>

                    {/* Seção: Faça sua Doação */}
                    <section id="doacao" className="mb-6">
                        <div className="bg-white p-6 rounded-lg shadow-md">
                            <h3 className="text-center text-xl font-bold mb-4">Faça sua Doação</h3>
                            <p className="text-center text-gray-600 mb-4">
                                Contamos com financiamento coletivo e patrocínios para manter o Historin.com. Apoie o Historin e nos ajude a cobrir os custos mensais da plataforma.
                            </p>
                            <div className="flex justify-center">
                                <button
                                    className="bg-[#8A5A44] text-white px-6 py-3 rounded-md hover:bg-[#D8A568] flex items-center space-x-2 transition-transform transform hover:scale-105"
                                    onClick={copyToClipboard}
                                >
                                    <i className="fas fa-copy"></i>
                                    <span>Copiar Chave Pix</span>
                                </button>
                            </div>
                        </div>
                    </section>

                    {/* Seção Entre em Contato */}
                    <section className="mb-6">
                        <h3 className="text-center text-xl font-bold mb-4">Entre em Contato Conosco</h3>
                        <div className="flex justify-around space-x-6">
                            {/* Link para WhatsApp */}
                            <a
                                href="https://wa.me/54993264627"
                                target="_blank"
                                rel="noopener noreferrer"
                                className="flex flex-col items-center text-green-500 hover:text-green-600 transition"
                            >
                                <i className="fab fa-whatsapp text-3xl"></i>
                                <span className="text-sm">WhatsApp</span>
                            </a>

                            {/* Link para E-mail */}
                            <a
                                href="mailto:contato@historin.com.br"
                                target="_blank"
                                rel="noopener noreferrer"
                                className="flex flex-col items-center text-blue-500 hover:text-blue-600 transition"
                            >
                                <i className="fas fa-envelope text-3xl"></i>
                                <span className="text-sm">E-mail</span>
                            </a>
                            {/* Link para Instagram */}
                            <a
                                href="https://www.instagram.com/historin_ofc/"
                                target="_blank"
                                rel="noopener noreferrer"
                                className="flex flex-col items-center text-pink-500 hover:text-pink-600 transition"
                            >
                                <i className="fab fa-instagram text-3xl"></i>
                                <span className="text-sm">Instagram</span>
                            </a>

                        </div>
                    </section>
                </div>
            );
        };

        // Função para copiar a chave Pix
        const copyToClipboard = () => {
            navigator.clipboard.writeText('00020101021126580014br.gov.bcb.pix01368eac1054-b957-4af2-88c7-046b743ece015204000053039865802BR5925allcom comercio e servico6009SAO PAULO622905251J87ZBFMDTY970D6AP39DEHSC6304FDFB');
            alert('Chave Pix copiada!');
        };




        // Página Compartilhar Acervo
        const AdicionarHistoria = () => {
            const [formData, setFormData] = useState({
                nome: '',
                telefone: '',
                local: '',
                historia: ''
            });

            const handleChange = (e) => {
                const { id, value } = e.target;
                setFormData({ ...formData, [id]: value });
            };

            const handleSubmit = async (e) => {
                e.preventDefault();

                const formspreeEndpoint = "https://formspree.io/f/meojbabr"; // Substitua pelo seu endpoint do Formspree

                const data = {
                    nome: formData.nome,
                    telefone: formData.telefone,
                    local: formData.local,
                    historia: formData.historia
                };

                try {
                    const response = await fetch(formspreeEndpoint, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        alert('História enviada com sucesso! Entraremos em contato para captar os materiais que serão postados no seu nome.');
                        setFormData({
                            nome: '',
                            telefone: '',
                            local: '',
                            historia: ''
                        });
                    } else {
                        alert('Houve um problema ao enviar sua história. Por favor, tente novamente.');
                    }
                } catch (error) {
                    console.error('Erro:', error);
                    alert('Houve um erro ao enviar sua história. Por favor, tente novamente.');
                }
            };

            return (
                <div className="p-4">
                    <header className="flex justify-between items-center mb-4">
                        <div className="text-2xl cursor-pointer">
                            <Link to="/">
                                <i className="fas fa-arrow-left"></i>
                            </Link>
                        </div>
                        <h1 className="text-lg font-bold">Compartilhe seu acervo</h1>
                        <div className="w-10 h-10"></div>
                    </header>
                    <div className="bg-[#f5f0e1] p-4 rounded-lg shadow-md max-w-lg mx-auto">
                        <p className="mb-4 text-gray-700">Dependemos de pessoas como você para aumentar nosso acervo. Vamos até o local para captar uma série de fotos ou até mesmo apenas uma história que você queira compartilhar.</p>
                        <form onSubmit={handleSubmit}>

                            <div className="mb-4">
                                <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="nome">Nome:</label>
                                <input
                                    className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                    id="nome"
                                    type="text"
                                    placeholder="Seu nome"
                                    value={formData.nome}
                                    onChange={handleChange}
                                    required
                                />
                            </div>

                            <div className="mb-4">
                                <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="telefone">Telefone:</label>
                                <input
                                    className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                    id="telefone"
                                    type="text"
                                    placeholder="Seu telefone"
                                    value={formData.telefone}
                                    onChange={handleChange}
                                    required
                                />
                            </div>

                            <div className="mb-4">
                                <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="local">Local:</label>
                                <input
                                    className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                    id="local"
                                    type="text"
                                    placeholder="Local relacionado à história"
                                    value={formData.local}
                                    onChange={handleChange}
                                    required
                                />
                            </div>

                            <div className="mb-4">
                                <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="historia">Conte sua história:</label>
                                <textarea
                                    className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                    id="historia"
                                    rows="4"
                                    placeholder="Compartilhe uma história relacionada ao local ou à época descrita. Pode ser um acontecimento histórico, memórias pessoais ou contribuições culturais."
                                    value={formData.historia}
                                    onChange={handleChange}
                                    required
                                ></textarea>
                            </div>

                            {/* Card informativo sobre o processo de captação de materiais */}
                            <div className="mb-4 p-4 bg-[#e2e8f0] rounded">
                                <p className="text-gray-700">
                                    Sua história passará por análise e entraremos em contato para captar os materiais que serão postados em seu nome.
                                </p>
                            </div>

                            <div className="flex items-center justify-center">
                                <button
                                    className="bg-[#8A5A44] hover:bg-[#5a3e2e] text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                                    type="submit"
                                >
                                    Enviar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Página Ruas e Histórias (Atualizada com seção "Destaque")
        const RuasEHistorias = () => {
            useEffect(() => {
                document.title = "Ruas e Histórias de Gramado - Explore o Historin";

                // Atualizar a meta descrição
                let metaDescription = document.querySelector('meta[name="description"]');
                if (metaDescription) {
                    metaDescription.setAttribute('content', 'Descubra as histórias fascinantes por trás das ruas de Gramado. Explore o Historin e conheça mais sobre o legado histórico da cidade.');
                } else {
                    metaDescription = document.createElement('meta');
                    metaDescription.name = "description";
                    metaDescription.content = 'Descubra as histórias fascinantes por trás das ruas de Gramado. Explore o Historin e conheça mais sobre o legado histórico da cidade.';
                    document.head.appendChild(metaDescription);
                }
            }, []);

            const [searchTerm, setSearchTerm] = useState('');
            const [filteredRuas, setFilteredRuas] = useState(ruas);
            const [filteredHistorias, setFilteredHistorias] = useState(historias);

            useEffect(() => {
                if (searchTerm === '') {
                    setFilteredRuas(ruas);
                    setFilteredHistorias(historias);
                } else {
                    const lowercasedTerm = searchTerm.toLowerCase();
                    setFilteredRuas(ruas.filter(rua => rua.nome.toLowerCase().includes(lowercasedTerm)));
                    setFilteredHistorias(historias.filter(historia => historia.titulo.toLowerCase().includes(lowercasedTerm)));
                }
            }, [searchTerm]);

            // Mapear filteredRuas para incluir uma foto aleatória das histórias associadas
            const filteredRuasWithImages = useMemo(() => {
                return filteredRuas.map(rua => {
                    const historiasDaRua = historias.filter(historia => historia.rua_id === rua.id);
                    const fotos = historiasDaRua.flatMap(historia => historia.fotos);
                    const randomFoto = fotos.length > 0 ? fotos[Math.floor(Math.random() * fotos.length)] : null;
                    return { ...rua, fotos: randomFoto };
                });
            }, [filteredRuas, historias]);

            return (
                <div className="p-4 w-full lg:w-4/5">
                    {/* Header e barra de busca fixa */}
                    <header className="sticky top-0 z-10 bg-white py-4">
                        <div className="flex justify-between items-center mb-4">
                            <div className="text-2xl cursor-pointer">
                                <Link to="/">
                                    <i className="fas fa-arrow-left"></i>
                                </Link>
                            </div>
                            <h1 className="text-lg font-bold">Ruas e Histórias</h1>
                            <div className="w-10 h-10"></div>
                        </div>
                        {/* Campo de Busca Aprimorado */}
                        <div className="relative mb-4">
                            <input
                                type="text"
                                placeholder="Buscar..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-full shadow-sm focus:outline-none focus:ring-2 focus:ring-[#8A5A44]"
                            />
                            <i className="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </header>

                    {/* Botão Ver Mapa */}
                    <div className="mb-4">
                        <Link to="/">
                            <button
                                className="w-full p-4 rounded-lg bg-[#8A5A44] text-white font-semibold flex items-center justify-center"
                            >
                                <i className="fas fa-map-marker-alt mr-2"></i> Ver Mapa
                            </button>
                        </Link>
                    </div>

                    {/* Seção "Destaque" */}
                    <section className="mb-6">
                        <h2 className="text-lg font-semibold mb-4">Destaque</h2>
                        <LegadoAfricanoCard />
                    </section>

                    {/* Seção de Todas as Ruas */}
                    <div>
                        <h2 className="text-lg font-semibold mb-2">Todas as Ruas</h2>
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            {filteredRuasWithImages.map(rua => (
                                <Link
                                    key={rua.id}
                                    to={`/rua/${rua.id}`}
                                    className="bg-white p-2 rounded-lg shadow cursor-pointer block hover:shadow-lg transition-shadow duration-300"
                                >
                                    <img src={rua.fotos || 'https://placehold.co/300x200'} alt={rua.nome} className="rounded-lg mb-2 w-full h-40 object-cover" />
                                    <h3 className="font-semibold">{rua.nome}</h3>
                                </Link>
                            ))}
                        </div>
                    </div>

                    {/* Seção de Todas as Histórias */}
                    <div className="mt-6">
                        <h2 className="text-lg font-semibold mb-2">Todas as Histórias</h2>
                        {filteredHistorias.map(historia => (
                            <Link
                                key={historia.id}
                                to={`/rua/${historia.rua_id}/historia/${historia.id}`}
                                className="bg-white p-2 rounded-lg shadow mb-2 flex items-center cursor-pointer block hover:shadow-lg transition-shadow duration-300"
                            >
                                <img src={historia.fotos[0] || 'https://placehold.co/100x100'} alt={historia.titulo} className="rounded-lg mr-2 w-24 h-24 object-cover" />
                                <div>
                                    <h3 className="font-semibold">{historia.titulo}</h3>
                                    <p className="text-sm text-gray-600">{historia.descricao.slice(0, 60)}...</p>
                                </div>
                            </Link>
                        ))}
                    </div>
                </div>
            );
        };


        // componente seção legado africano
        const LegadoAfricanoCard = () => {
            return (
                <div className="px-4 mt-6">
                    {/* Card que direciona para a página do Legado Africano */}
                    <Link to="/legado-africano" className="block bg-white p-6 rounded-lg shadow mb-4 hover:shadow-lg transition-shadow duration-300">
                        <div className="flex flex-col md:flex-row items-center">
                            <img src="fotos/legado-africano-gramado.png" alt="Legado Africano" className="w-56 h-32 object-cover rounded-lg mb-4 md:mb-0 md:mr-4" />
                            <div>
                                <h2 className="text-xl font-bold mb-2">Legado Afro-brasileiro em Gramado</h2>
                                <p className="text-gray-700">
                                    Conheça a história e o legado afro-brasileiro em Gramado. Descubra relatos e contribuições da população negra na formação cultural da cidade.
                                </p>
                            </div>
                        </div>
                    </Link>
                </div>
            );
        };

        // Componente de Carrossel Reutilizável
        const Carousel = ({ items, onItemClick, type }) => (
            <div className="carousel">
                {items.map(item => (
                    <div
                        key={item.id}
                        className="carousel-item"
                        onClick={() => onItemClick(item)}
                    >
                        <img src={item.fotos || (type === 'rua' ? 'https://placehold.co/200x150' : 'https://placehold.co/200x150')} alt={item.nome || item.titulo} className="w-full h-40 object-cover rounded-lg" />
                        <div className="item-content">
                            <h3 className="font-semibold text-sm">{item.nome || item.titulo}</h3>
                        </div>
                    </div>
                ))}
            </div>
        );



        //componente de mapa
        const MapView = ({ setSelectedRuaId, setPreviewContent }) => {
            const [selectedType, setSelectedType] = useState('ruas'); // Variável para definir o tipo de marcador: ruas ou histórias
            const mapRef = useRef(null); // Referência ao mapa Leaflet
            const markersRef = useRef([]); // Armazena os marcadores atuais para removê-los e atualizar o mapa

            useEffect(() => {
                // Inicializa o mapa apenas uma vez, centrado nas coordenadas fornecidas
                mapRef.current = L.map('map').setView([-29.368110031921475, -50.83614840951764], 12);
                // Adiciona as tiles do OpenStreetMap com a devida atribuição
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors'
                }).addTo(mapRef.current);

                // Adiciona os marcadores iniciais
                addMarkers();

                return () => {
                    // Remove o mapa quando o componente for desmontado
                    mapRef.current.remove();
                };
            }, []);

            useEffect(() => {
                // Atualiza os marcadores sempre que o tipo selecionado (ruas ou histórias) mudar
                addMarkers();
            }, [selectedType]);

            const addMarkers = () => {
                // Remove todos os marcadores existentes do mapa antes de adicionar novos
                markersRef.current.forEach(marker => {
                    mapRef.current.removeLayer(marker);
                });
                markersRef.current = [];

                if (selectedType === 'ruas') {
                    // Ícone para ruas
                    const ruaIcon = L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34],
                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.4/images/marker-shadow.png',
                        shadowSize: [41, 41]
                    });

                    ruas.forEach(rua => {
                        // Verificação de coordenadas válidas
                        if (
                            rua.coordenadas &&
                            Array.isArray(rua.coordenadas) &&
                            rua.coordenadas.length === 2 &&
                            typeof rua.coordenadas[0] === 'number' &&
                            typeof rua.coordenadas[1] === 'number'
                        ) {
                            const marker = L.marker(rua.coordenadas, { icon: ruaIcon }).addTo(mapRef.current);
                            marker.bindPopup(`
                        <b>${rua.nome}</b><br>
                        <a href="https://www.google.com/maps?q=${rua.coordenadas[0]},${rua.coordenadas[1]}" target="_blank">
                            Ver no Google Maps
                        </a>
                    `);

                            marker.on('click', () => {
                                setSelectedRuaId(rua.id);
                                setPreviewContent({
                                    type: 'rua',
                                    title: rua.nome,
                                    description: rua.descricao,
                                    images: historias.filter(h => h.rua_id === rua.id).flatMap(h => h.fotos),
                                    ruaId: rua.id,
                                });
                            });

                            markersRef.current.push(marker);
                        } else {
                            console.warn(`Rua "${rua.nome}" não possui coordenadas válidas e foi ignorada.`);
                        }
                    });
                } else if (selectedType === 'historias') {
                    // Ícone para histórias
                    const historiaIcon = L.icon({
                        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34],
                        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.4/images/marker-shadow.png',
                        shadowSize: [41, 41]
                    });

                    historias.forEach(historia => {
                        // Verificação de coordenadas válidas
                        if (
                            historia.coordenadas &&
                            Array.isArray(historia.coordenadas) &&
                            historia.coordenadas.length === 2 &&
                            typeof historia.coordenadas[0] === 'number' &&
                            typeof historia.coordenadas[1] === 'number'
                        ) {
                            const marker = L.marker(historia.coordenadas, { icon: historiaIcon }).addTo(mapRef.current);
                            marker.bindPopup(`
                        <b>${historia.titulo}</b><br>
                        <a href="https://www.google.com/maps?q=${historia.coordenadas[0]},${historia.coordenadas[1]}" target="_blank">
                            Ver no Google Maps
                        </a>
                    `);

                            marker.on('click', () => {
                                setSelectedRuaId(historia.rua_id);
                                setPreviewContent({
                                    type: 'historia',
                                    title: historia.titulo,
                                    description: historia.descricao,
                                    images: historia.fotos,
                                    historiaId: historia.id,
                                    ruaId: historia.rua_id,
                                });
                            });

                            markersRef.current.push(marker);
                        } else {
                            console.warn(`História "${historia.titulo}" não possui coordenadas válidas e foi ignorada.`);
                        }
                    });
                }
            };

            return (
                <div className="map-container relative">
                    {/* Botões no canto superior esquerdo para alternar entre marcadores de ruas e histórias */}
                    <div className="absolute top-2 left-2 z-50">
                        <button
                            onClick={() => setSelectedType('ruas')}
                            className={`px-4 py-2 ${selectedType === 'ruas' ? 'bg-blue-500 text-white' : 'bg-white text-black'} rounded-l-md`}
                        >
                            Ruas
                        </button>
                        <button
                            onClick={() => setSelectedType('historias')}
                            className={`px-4 py-2 ${selectedType === 'historias' ? 'bg-[#cb2940] text-white' : 'bg-white text-black'} rounded-r-md`}
                        >
                            Histórias
                        </button>
                    </div>
                    {/* Div do Mapa, onde o mapa será renderizado */}
                    <div id="map" className="h-full"></div>
                </div>
            );
        };



        // Componente de Preview 
const Preview = ({ previewContent, onClose }) => {
    let linkTo = '/';
    if (previewContent.type === 'rua') {
        linkTo = `/rua/${previewContent.ruaId}`;
    } else if (previewContent.type === 'historia') {
        linkTo = `/rua/${previewContent.ruaId}/historia/${previewContent.historiaId}`;
    }

    // Função para obter a URL da imagem
    const getFirstImageUrl = (images) => {
        if (!images || images.length === 0) {
            return 'https://placehold.co/400x200'; // Imagem padrão
        }
        const firstImage = images[0];
        return typeof firstImage === 'string' ? firstImage : firstImage.url; // Verifica se é string ou objeto
    };

    return (
        <div className="preview-card">
            <Link to={linkTo} className="block" onClick={onClose}>
                <img 
                    src={getFirstImageUrl(previewContent.images)} 
                    alt={previewContent.title} 
                    className="w-full h-40 object-cover rounded-lg" 
                />
                <div className="preview-content mt-2">
                    <h3 className="font-semibold">{previewContent.title}</h3>
                    <p className="text-sm">{previewContent.description.slice(0, 100)}...</p>
                </div>
            </Link>
            <button
                onClick={onClose}
                className="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-md hover:bg-red-700 focus:outline-none"
            >
                Fechar
            </button>
        </div>
    );
};


        // Componente de Seleção de Cidade com Botão "Voltar ao Mapa"
        const CityCarousel = ({ cidades, handleCityClick, selectedCityId }) => {
            const carouselRef = useRef(null);

            useEffect(() => {
                if (carouselRef.current && selectedCityId) {
                    const selectedElement = carouselRef.current.querySelector(`[data-id='${selectedCityId}']`);
                    if (selectedElement) {
                        const carouselWidth = carouselRef.current.offsetWidth;
                        const selectedElementOffset = selectedElement.offsetLeft;
                        const selectedElementWidth = selectedElement.offsetWidth;

                        const scrollPosition = selectedElementOffset - (carouselWidth / 2) + (selectedElementWidth / 2);
                        window.requestAnimationFrame(() => {
                            carouselRef.current.scrollTo({ left: scrollPosition, behavior: 'smooth' });
                        });
                    }
                }
            }, [selectedCityId]);

            return (
                <div className="w-full flex items-center">
                    {/* Botão de Voltar ao Mapa */}
                    <Link
                        to="/"
                        className="flex items-center px-4 py-2 mr-4 bg-gray-300 hover:bg-gray-400 rounded-full cursor-pointer transition-colors"
                        aria-label="Voltar ao Mapa"
                    >
                        <i className="fas fa-arrow-left mr-2"></i>
                        <span>Voltar ao Mapa</span>
                    </Link>

                    {/* Carrossel de Cidades */}
                    <div ref={carouselRef} className="overflow-x-auto whitespace-nowrap flex-grow">
                        <div className="flex space-x-2 inline-flex">
                            {cidades.map(cidade => (
                                <span
                                    key={cidade.id}
                                    data-id={cidade.id}
                                    className={`px-4 py-2 rounded-full cursor-pointer whitespace-nowrap 
                            ${cidade.id === selectedCityId ? 'bg-[#8A5A44] text-white' : 'bg-gray-200'}`}
                                    onClick={() => handleCityClick(cidade)}
                                >
                                    {cidade.nome}
                                </span>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };




        // Componente de Seleção de Rua
        const RuaCarousel = ({ ruas, handleRuaClick, selectedRuaId }) => {
            const carouselRef = useRef(null);

            useEffect(() => {
                if (carouselRef.current && selectedRuaId) {
                    const selectedElement = carouselRef.current.querySelector(`[data-id='${selectedRuaId}']`);
                    if (selectedElement) {
                        const carouselWidth = carouselRef.current.offsetWidth;
                        const selectedElementOffset = selectedElement.offsetLeft;
                        const selectedElementWidth = selectedElement.offsetWidth;

                        const scrollPosition = selectedElementOffset - (carouselWidth / 2) + (selectedElementWidth / 2);
                        window.requestAnimationFrame(() => {
                            carouselRef.current.scrollTo({ left: scrollPosition, behavior: 'smooth' });
                        });
                    }
                }
            }, [selectedRuaId]);

            return (
                <div className="w-full">
                    <div ref={carouselRef} className="overflow-x-auto whitespace-nowrap py-2">
                        <div className="flex space-x-2 inline-flex">
                            {ruas.map(rua => (
                                <span
                                    key={rua.id}
                                    data-id={rua.id}
                                    className={`px-4 py-2 rounded-full cursor-pointer whitespace-nowrap 
                            ${rua.id === selectedRuaId ? 'bg-[#8A5A44] text-white' : 'bg-gray-200'}`}
                                    onClick={() => handleRuaClick(rua)}
                                >
                                    {rua.nome}
                                </span>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const Referencias = () => {
            const [activeSection, setActiveSection] = useState(null);
            const location = useLocation();

            useEffect(() => {
                // Atualizar título e meta descrição dinamicamente
                document.title = "Referências - Historin";
                let metaDescription = document.querySelector('meta[name="description"]');
                if (metaDescription) {
                    metaDescription.setAttribute(
                        'content',
                        'Explore uma ampla variedade de referências históricas, incluindo organizações, autores e obras selecionadas no Historin.'
                    );
                } else {
                    metaDescription = document.createElement('meta');
                    metaDescription.name = "description";
                    metaDescription.content =
                        'Explore uma ampla variedade de referências históricas, incluindo organizações, autores e obras selecionadas no Historin.';
                    document.head.appendChild(metaDescription);
                }
            }, []);

            useEffect(() => {
                // Extrair o parâmetro 'section' da URL
                const params = new URLSearchParams(location.search);
                const section = params.get('section');
                if (section === 'orgs' || section === 'autores' || section === 'obras') {
                    setActiveSection(section);
                }
            }, [location]);

            const toggleSection = (sectionName) => {
                setActiveSection(prevSection => (prevSection === sectionName ? null : sectionName));
            };

            return (
                <div className="referencias px-4 md:px-8 lg:px-16 py-8">
                    {/* Título Principal */}
                    <h1 className="text-3xl font-bold text-center">Referências</h1>
                    <h3 className="font-bold text-center mb-6">+ Conteúdo</h3>

                    {/* Parágrafo Descritivo */}
                    <p className="text-center text-gray-700 mb-8 max-w-2xl mx-auto">
                        Nesta página, você encontrará uma ampla variedade de referências para aprofundar seu conhecimento histórico. Nosso objetivo é incentivar o interesse das pessoas e disseminar conteúdo histórico relevante, fornecendo fontes confiáveis e diversas para a exploração da rica história que a nossa plataforma oferece.
                    </p>

                    {/* Seção Organizações */}
                    <section className="orgs mb-8">
                        <button
                            className="flex items-center justify-between w-full px-4 py-2 text-2xl font-semibold text-left bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none transition-colors duration-200"
                            onClick={() => toggleSection('orgs')}
                        >
                            <span>Organizações</span>
                            <svg
                                className={`w-6 h-6 transform transition-transform duration-200 ${activeSection === 'orgs' ? 'rotate-180' : 'rotate-0'}`}
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        {activeSection === 'orgs' && (
                            <div className="mt-4">
                                {orgs.map(org => (
                                    <div key={org.id} className="org bg-white shadow-md p-4 rounded-lg mb-4">
                                        <img
                                            src={org.logo}
                                            alt={`${org.fantasia} logo`}
                                            className="h-32 mx-auto mb-4 object-contain"
                                        />
                                        <h3 className="text-xl font-bold text-center">{org.fantasia}</h3>
                                        <p className="text-gray-700 mt-2">{org.sobre}</p>
                                        <a href={org.link} className="text-blue-500 hover:underline mt-2 block text-center">Visitar site</a>
                                    </div>
                                ))}
                            </div>
                        )}
                    </section>

                    {/* Seção Autores */}
                    <section className="autores mb-8">
                        <button
                            className="flex items-center justify-between w-full px-4 py-2 text-2xl font-semibold text-left bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none transition-colors duration-200"
                            onClick={() => toggleSection('autores')}
                        >
                            <span>Autores</span>
                            <svg
                                className={`w-6 h-6 transform transition-transform duration-200 ${activeSection === 'autores' ? 'rotate-180' : 'rotate-0'}`}
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        {activeSection === 'autores' && (
                            <div className="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {autores.map(autor => (
                                    <div key={autor.id} className="autor bg-white shadow-md p-4 rounded-lg flex flex-col items-center">
                                        <img src={autor.foto} alt={autor.nome} className="w-24 h-24 mb-4 rounded-full object-cover" />
                                        <h3 className="text-xl font-bold text-center">{autor.nome}</h3>
                                        <p className="text-gray-700 text-center mt-2">{autor.bio}</p>
                                    </div>
                                ))}
                            </div>
                        )}
                    </section>

                    {/* Seção Obras */}
                    <section className="obras mb-8">
                        <button
                            className="flex items-center justify-between w-full px-4 py-2 text-2xl font-semibold text-left bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none transition-colors duration-200"
                            onClick={() => toggleSection('obras')}
                        >
                            <span>Obras</span>
                            <svg
                                className={`w-6 h-6 transform transition-transform duration-200 ${activeSection === 'obras' ? 'rotate-180' : 'rotate-0'}`}
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        {activeSection === 'obras' && (
                            <div className="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {obras.map(obra => (
                                    <div key={obra.id} className="obra bg-white shadow-md p-4 rounded-lg">
                                        <img src={obra.capa} alt={obra.titulo} className="w-full h-40 object-cover mb-4 rounded-lg" />
                                        <h3 className="text-xl font-bold">{obra.titulo}</h3>
                                        <p className="text-gray-700 mt-2">{obra.descricao}</p>
                                        <a href={obra.link} className="text-blue-500 hover:underline mt-2 block">
                                            {obra.pago ? "Adquirir" : "Ler gratuitamente"}
                                        </a>
                                    </div>
                                ))}
                            </div>
                        )}
                    </section>

                    {/* Seção Sites */}
                    <section className="sites mb-8">
                        <button
                            className="flex items-center justify-between w-full px-4 py-2 text-2xl font-semibold text-left bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none transition-colors duration-200"
                            onClick={() => toggleSection("sites")}
                        >
                            <span>Sites</span>
                            <svg
                                className={`w-6 h-6 transform transition-transform duration-200 ${activeSection === "sites" ? "rotate-180" : "rotate-0"
                                    }`}
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </button>
                        {activeSection === "sites" && (
                            <div className="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {sites.map((site) => (
                                    <div key={site.id} className="site bg-white shadow-md p-4 rounded-lg flex flex-col items-center">
                                        <img
                                            src={site.logo}
                                            alt={`${site.nome} logo`}
                                            className="w-24 h-24 mb-4 rounded-lg object-contain"
                                        />
                                        <h3 className="text-xl font-bold text-center">{site.nome}</h3>
                                        <a
                                            href={site.link}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="text-blue-500 hover:underline mt-2 block text-center"
                                        >
                                            Visitar site
                                        </a>
                                    </div>
                                ))}
                            </div>
                        )}
                    </section>

                    {/* Seção de Vídeos */}
                    <section className="videos mb-8">
                        <h2 className="pl-4 text-2xl font-semibold mb-4">Vídeos</h2>
                        <div className="video-container">
                            <iframe
                                width="100%"
                                height="500"
                                src="https://www.youtube.com/embed/videoseries?list=PL7HcHb8oOEF8p3w7QAc5LPFVVaBP1SNoP"
                                title="YouTube playlist"
                                frameBorder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowFullScreen
                                className="rounded-lg shadow-md"
                            ></iframe>
                        </div>
                    </section>
                </div>
            );

        };

        // PAGINA Conteúdo da História (Atualizado)
        const HistoriaContent = ({
            currentHistory,
            historiasDaRua,
            currentIndex,
            setCurrentIndex,
            setCurrentHistory,
            showAllStories,
            setShowAllStories,
            selectedRuaId,
            activeTab,
            changeTab,
            rua,
            cidade,
            orgs, // Recebendo 'orgs' como prop
            negocios, // Recebendo 'negocios' como prop, assumindo que também está definido
        }) => {
            const { useState, useEffect, useRef } = React;
            const history = useHistory();
            const location = useLocation();

            // Estados para modais e zoom
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [selectedImage, setSelectedImage] = useState(null);
            const [currentZoom, setCurrentZoom] = useState(1);
            const [translateX, setTranslateX] = useState(0);
            const [translateY, setTranslateY] = useState(0);
            const [showLocaisRecomendados, setShowLocaisRecomendados] = useState(false);
            const [showCreditModal, setShowCreditModal] = useState(false);
            const [currentPhoto, setCurrentPhoto] = useState(null);

            const isDraggingRef = useRef(false);
            const startXRef = useRef(0);
            const startYRef = useRef(0);
            const initialTranslateXRef = useRef(0);
            const initialTranslateYRef = useRef(0);

            const modalImageRef = useRef(null);

            // Funções de navegação entre histórias
            const handlePrev = () => {
                if (currentIndex > 0) {
                    const newIndex = currentIndex - 1;
                    const newHistory = historiasDaRua[newIndex];
                    history.replace(`/rua/${selectedRuaId}/historia/${newHistory.id}`);
                    setCurrentHistory(newHistory);
                    setCurrentIndex(newIndex);
                    changeTab('historia'); // Reset para aba 'historia'
                }
            };

            const handleNext = () => {
                if (currentIndex < historiasDaRua.length - 1) {
                    const newIndex = currentIndex + 1;
                    const newHistory = historiasDaRua[newIndex];
                    history.replace(`/rua/${selectedRuaId}/historia/${newHistory.id}`);
                    setCurrentHistory(newHistory);
                    setCurrentIndex(newIndex);
                    changeTab('historia'); // Reset para aba 'historia'
                }
            };

            const handleRangeChange = (event) => {
                const newIndex = parseInt(event.target.value);
                if (newIndex >= 0 && newIndex < historiasDaRua.length) {
                    const newHistory = historiasDaRua[newIndex];
                    history.replace(`/rua/${selectedRuaId}/historia/${newHistory.id}`);
                    setCurrentHistory(newHistory);
                    setCurrentIndex(newIndex);
                    changeTab('historia'); // Reset para aba 'historia'
                }
            };

            // Funções para abrir e fechar modais
            const openModal = (foto) => {
                setSelectedImage(foto);
                setIsModalOpen(true);
                setCurrentZoom(1);
                setTranslateX(0);
                setTranslateY(0);
            };

            const closeModal = () => {
                setIsModalOpen(false);
                setSelectedImage(null);
                setCurrentZoom(1);
                setTranslateX(0);
                setTranslateY(0);
            };

            // Fecha o modal ao pressionar a tecla Escape
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.key === 'Escape') {
                        closeModal();
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, []);

            // Funções para panning (arrastar) na imagem do modal
            const handleMouseDown = (e) => {
                if (currentZoom <= 1) return;
                isDraggingRef.current = true;
                startXRef.current = e.clientX;
                startYRef.current = e.clientY;
                initialTranslateXRef.current = translateX;
                initialTranslateYRef.current = translateY;

                window.addEventListener('mousemove', handleMouseMove);
                window.addEventListener('mouseup', handleMouseUp);
            };

            const handleMouseMove = (e) => {
                if (!isDraggingRef.current) return;

                const deltaX = e.clientX - startXRef.current;
                const deltaY = e.clientY - startYRef.current;

                setTranslateX(initialTranslateXRef.current + deltaX);
                setTranslateY(initialTranslateYRef.current + deltaY);
            };

            const handleMouseUp = () => {
                isDraggingRef.current = false;
                window.removeEventListener('mousemove', handleMouseMove);
                window.removeEventListener('mouseup', handleMouseUp);
            };

            // Funções para panning em dispositivos móveis
            const handleTouchStartPan = (e) => {
                if (currentZoom <= 1 || e.touches.length !== 1) return;

                isDraggingRef.current = true;
                startXRef.current = e.touches[0].clientX;
                startYRef.current = e.touches[0].clientY;
                initialTranslateXRef.current = translateX;
                initialTranslateYRef.current = translateY;

                window.addEventListener('touchmove', handleTouchMovePan);
                window.addEventListener('touchend', handleTouchEndPan);
            };

            const handleTouchMovePan = (e) => {
                if (!isDraggingRef.current || e.touches.length !== 1) return;

                const deltaX = e.touches[0].clientX - startXRef.current;
                const deltaY = e.touches[0].clientY - startYRef.current;

                setTranslateX(initialTranslateXRef.current + deltaX);
                setTranslateY(initialTranslateYRef.current + deltaY);
            };

            const handleTouchEndPan = () => {
                isDraggingRef.current = false;
                window.removeEventListener('touchmove', handleTouchMovePan);
                window.removeEventListener('touchend', handleTouchEndPan);
            };

            // Fetching organization data if available
            const org =
                currentHistory && currentHistory.orgId
                    ? orgs.find((o) => o.id === currentHistory.orgId)
                    : null;

            // Verifica se há uma história atual para exibir na aba 'historia'
            if (!currentHistory && activeTab === 'historia') {
                return (
                    <div className="w-full py-4">
                        <h2 className="text-xl font-bold">Nenhuma história disponível para esta rua.</h2>
                    </div>
                );
            }

            return (
                <div className="main-content w-full flex flex-col items-center flex-grow overflow-y-auto">
                    {/* Abas */}
                    <div className="w-full lg:py-4 flex justify-between items-center border-b border-gray-300">
                        <div className="flex items-center space-x-4">
                            <button
                                className={`px-4 py-2 font-semibold text-sm ${activeTab === 'historia'
                                    ? 'border-b-2 border-blue-500 text-blue-500'
                                    : 'text-gray-600 hover:text-blue-500'
                                    }`}
                                onClick={() => changeTab('historia')}
                            >
                                História
                            </button>
                            <button
                                className={`px-4 py-2 font-semibold text-sm ${activeTab === 'rua'
                                    ? 'border-b-2 border-blue-500 text-blue-500'
                                    : 'text-gray-600 hover:text-blue-500'
                                    }`}
                                onClick={() => changeTab('rua')}
                            >
                                Rua
                            </button>
                            <button
                                className={`px-4 py-2 font-semibold text-sm ${activeTab === 'cidade'
                                    ? 'border-b-2 border-blue-500 text-blue-500'
                                    : 'text-gray-600 hover:text-blue-500'
                                    }`}
                                onClick={() => changeTab('cidade')}
                            >
                                Cidade
                            </button>
                        </div>
                    </div>

                    {/* Conteúdo baseado na aba ativa */}
                    {activeTab === 'historia' && (
                        <>
                            {/* Conteúdo da aba 'História' */}
                            {showAllStories ? (
                                <div className="w-full py-2 md:py-4">
                                    {historiasDaRua.map((historia, index) => (
                                        <div key={historia.id} className="w-full mb-4 bg-white p-4 rounded-lg shadow-md">
                                            <h3 className="text-xl font-bold">{historia.titulo}</h3>
                                            <p className="text-sm text-gray-600">Por: {historia.criador || 'Desconhecido'}</p>
                                            <p className="text-sm text-gray-600">Ano: {historia.ano}</p>
                                            {historia.fotos && historia.fotos.length > 0 && (
                                                <div className="mt-2 grid grid-cols-2 gap-2">
                                                    {historia.fotos.map((foto, fotoIndex) => {
                                                        const isObject = typeof foto === 'object' && foto !== null;
                                                        const url = isObject ? foto.url : foto;
                                                        const credito = isObject ? foto.credito : null;

                                                        return (
                                                            <div key={fotoIndex} className="relative">
                                                                <img
                                                                    src={url}
                                                                    alt={`Foto de ${historia.titulo} ${fotoIndex + 1}`}
                                                                    className="w-full h-32 object-cover rounded-md cursor-pointer"
                                                                    onClick={() => openModal({ url, credito })}
                                                                />
                                                                {credito ? (
                                                                    <p className="text-sm text-gray-600 mt-1">{credito}</p>
                                                                ) : (
                                                                    <p className="text-sm mt-1">
                                                                        <button
                                                                            onClick={() => {
                                                                                setCurrentPhoto(foto);
                                                                                setShowCreditModal(true);
                                                                            }}
                                                                            className="text-blue-600 underline"
                                                                            aria-label="Indicar crédito"
                                                                        >
                                                                            Reportar Crédito
                                                                        </button>
                                                                    </p>
                                                                )}
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            )}
                                            <div className="mt-2 max-h-40 overflow-y-scroll">
                                                <p>{historia.descricao}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <>
                                    {/* Conteúdo da história atual */}
                                    <div className="w-full py-2 md:py-4">
                                        <div className="border border-black px-2 rounded-md max-h-60 overflow-y-scroll bg-[#f5f1e8]">
                                            <div className="sticky top-0 bg-[#f5f1e8] pb-2">
                                                <h3 className="text-xl pt-2 md:text-2xl font-bold mb-1">
                                                    {currentHistory.titulo}
                                                </h3>
                                                <div className="flex justify-between items-center text-sm text-gray-600">
                                                    <span>Por: {currentHistory.criador || 'Desconhecido'}</span>
                                                    <span>Ano: {currentHistory.ano}</span>
                                                    {currentHistory.coordenadas &&
                                                        currentHistory.coordenadas.length === 2 && (
                                                            <a
                                                                href={`https://www.google.com/maps?q=${currentHistory.coordenadas[0]},${currentHistory.coordenadas[1]}`}
                                                                target="_blank"
                                                                rel="noopener noreferrer"
                                                                className="text-blue-600 hover:underline"
                                                            >
                                                                Ver no Maps
                                                            </a>
                                                        )}
                                                </div>
                                            </div>
                                            <p>{currentHistory.descricao}</p>
                                        </div>
                                    </div>

                                    {/* Carrossel de Fotos */}
                                    <div className="w-full border-b border-black py-4 md:py-8 text-center">
                                        <div className="carousel grid grid-cols-1 gap-2">
                                            {currentHistory.fotos &&
                                                currentHistory.fotos.map((foto, index) => {
                                                    const isObject = typeof foto === 'object' && foto !== null;
                                                    const url = isObject ? foto.url : foto;
                                                    const credito = isObject ? foto.credito : null;

                                                    return (
                                                        <div key={index} className="relative">
                                                            <img
                                                                src={url}
                                                                alt={`Foto de ${currentHistory.ano} ${index + 1}`}
                                                                className="w-full h-auto object-cover rounded-lg shadow-md cursor-pointer"
                                                                onClick={() => openModal({ url, credito })}
                                                            />
                                                            {credito ? (
                                                                <p className="text-sm text-gray-600 mt-1">{credito}</p>
                                                            ) : (
                                                                <p className="text-sm mt-1">
                                                                    <button
                                                                        onClick={() => {
                                                                            setCurrentPhoto(foto);
                                                                            setShowCreditModal(true);
                                                                        }}
                                                                        className="text-blue-600 underline"
                                                                        aria-label="Indicar crédito"
                                                                    >
                                                                        Reportar Crédito
                                                                    </button>
                                                                </p>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                        </div>
                                    </div>
                                </>
                            )}
                        </>
                    )}

                    {activeTab === 'rua' && (
                        <>
                            {/* Conteúdo da aba 'Rua' */}
                            <div className="w-full py-2 lg:py-4">
                                <h3 className="text-xl font-bold mb-4">{rua.nome}</h3>
                                <div className="border border-black p-3 rounded-md max-h-64 overflow-y-scroll bg-[#f5f1e8]">
                                    <p>{rua.descricao}</p>
                                </div>
                                <div className="border-b border-black pb-2 mt-4 grid grid-cols-2 gap-2">
                                    {rua.fotos && rua.fotos.length > 0 ? (
                                        rua.fotos.map((foto, index) => (
                                            <img
                                                key={index}
                                                src={foto}
                                                alt={`Foto da rua ${index + 1}`}
                                                className="w-full h-auto object-cover rounded-md cursor-pointer"
                                                onClick={() => openModal({ url: foto })}
                                            />
                                        ))
                                    ) : (
                                        <p className="text-gray-600">Nenhuma foto disponível.</p>
                                    )}
                                </div>
                            </div>
                        </>
                    )}

                    {activeTab === 'cidade' && (
                        <div className="w-full py-4 px-4 md:px-8">
                            <h3 className="text-2xl font-bold mb-6 text-center">
                                {cidade.nome || 'Cidade não identificada'}
                            </h3>

                            {/* Descrição da cidade com formatação */}
                            {cidade.descricao ? (
                                <div
                                    className="description-container max-w-none mb-8 mx-auto text-justify"
                                    dangerouslySetInnerHTML={{ __html: cidade.descricao }}
                                ></div>
                            ) : (
                                <p className="text-gray-600 mb-8">
                                    Informações sobre a cidade não disponíveis.
                                </p>
                            )}

                            {/* Informações do Prefeito */}
                            {cidade.prefeito && (
                                <div className="mb-12">
                                    <h4 className="text-xl font-semibold mb-6 text-center">Prefeito</h4>
                                    <div className="flex flex-col items-center">
                                        {cidade.prefeito.foto && (
                                            <img
                                                src={cidade.prefeito.foto}
                                                alt={cidade.prefeito.nome}
                                                className="w-32 h-32 object-cover rounded-full mb-4 shadow-lg"
                                            />
                                        )}
                                        <div className="text-center">
                                            <p className="text-lg font-bold">{cidade.prefeito.nome}</p>
                                            <p>Número de mandatos: {cidade.prefeito.mandatos}</p>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Informações dos Vereadores */}
                            {cidade.vereadores && cidade.vereadores.length > 0 && (
                                <div className="mb-12">
                                    <h4 className="text-xl font-semibold mb-6 text-center">Vereadores</h4>
                                    <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-6">
                                        {cidade.vereadores.map((vereador, index) => (
                                            <div key={index} className="flex flex-col items-center">
                                                {vereador.foto && (
                                                    <img
                                                        src={vereador.foto}
                                                        alt={vereador.nome}
                                                        className="w-24 h-24 object-cover rounded-full mb-2 shadow-md"
                                                    />
                                                )}
                                                <p className="text-center font-medium">{vereador.nome}</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Eventos */}
                            {cidade.eventos && cidade.eventos.length > 0 && (
                                <div className="mb-12">
                                    <h4 className="text-xl font-semibold mb-6 text-center">Eventos</h4>
                                    {cidade.eventos.map((evento) => (
                                        <div key={evento.id} className="mb-12">
                                            <h5 className="text-lg font-bold mb-2">{evento.nome}</h5>
                                            <p className="text-sm text-gray-600 mb-2">
                                                Início: {evento.inicio} | Data: {evento.data}
                                            </p>
                                            <p className="mb-4">{evento.descricao}</p>
                                            {/* Fotos dos Eventos */}
                                            {evento.fotos && evento.fotos.length > 0 && (
                                                <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                                                    {evento.fotos.map((foto, index) => (
                                                        <img
                                                            key={index}
                                                            src={foto}
                                                            alt={`Foto do evento ${evento.nome} ${index + 1}`}
                                                            className="w-full h-40 object-cover rounded-md cursor-pointer shadow-sm hover:shadow-md transition-shadow duration-300"
                                                            onClick={() => openModal({ url: foto })}
                                                        />
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}

                    {/* Modal para Reportar Crédito */}
                    {showCreditModal && (
                        <div
                            className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
                            onClick={() => setShowCreditModal(false)}
                        >
                            <div
                                className="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative"
                                onClick={(e) => e.stopPropagation()}
                            >
                                <button
                                    className="absolute top-2 right-2 text-gray-600 hover:text-gray-800"
                                    onClick={() => setShowCreditModal(false)}
                                    aria-label="Fechar formulário"
                                >
                                    <i className="fas fa-times text-xl"></i>
                                </button>
                                <h3 className="text-xl font-bold mb-4 text-center">Reportar proprietário de créditos</h3>
                                <form action="https://formspree.io/f/mwpkazda" method="POST">
                                    <div className="mb-4">
                                        <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="nome">
                                            Nome:
                                        </label>
                                        <input
                                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                            id="nome"
                                            type="text"
                                            name="nome"
                                            placeholder="Seu nome"
                                            required
                                        />
                                    </div>
                                    <div className="mb-4">
                                        <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="email">
                                            E-mail:
                                        </label>
                                        <input
                                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                            id="email"
                                            type="email"
                                            name="email"
                                            placeholder="Seu e-mail"
                                            required
                                        />
                                    </div>
                                    <div className="mb-4">
                                        <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="mensagem">
                                            Mensagem:
                                        </label>
                                        <textarea
                                            className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                            id="mensagem"
                                            name="mensagem"
                                            rows="4"
                                            placeholder="Detalhe sobre a propriedade de crédito ou outras observações."
                                            required
                                        ></textarea>
                                    </div>
                                    <input
                                        type="hidden"
                                        name="photo_url"
                                        value={currentPhoto ? currentPhoto.url || currentPhoto : ''}
                                    />
                                    <div className="flex items-center justify-center">
                                        <button
                                            type="submit"
                                            className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                                        >
                                            Enviar
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Modal de Imagem com Zoom e Panning */}
                    {isModalOpen && selectedImage && (
                        <div
                            className="fixed inset-0 z-50 flex flex-col items-center justify-center bg-black bg-opacity-75"
                            onClick={closeModal}
                        >
                            <img
                                ref={modalImageRef}
                                src={selectedImage.url}
                                alt="Imagem ampliada"
                                className="max-w-[90%] max-h-[90%] object-contain cursor-grab"
                                style={{
                                    transform: `scale(${currentZoom}) translate(${translateX}px, ${translateY}px)`,
                                    transition: 'transform 0.3s ease',
                                    cursor: currentZoom > 1 ? 'grab' : 'default',
                                }}
                                onClick={(e) => e.stopPropagation()}
                                onMouseDown={handleMouseDown}
                                onTouchStart={handleTouchStartPan}
                                draggable="false"
                            />
                            {selectedImage.credito && (
                                <p className="text-white mt-2">{selectedImage.credito}</p>
                            )}
                            <button
                                className="absolute top-4 right-4 text-white text-2xl bg-black bg-opacity-50 rounded-full p-2 hover:bg-opacity-75 focus:outline-none"
                                onClick={closeModal}
                                aria-label="Fechar modal"
                            >
                                &times;
                            </button>
                            <div className="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-4">
                                <button
                                    className="bg-white p-2 rounded-full shadow hover:bg-gray-200 focus:outline-none"
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        setCurrentZoom((prevZoom) => Math.min(prevZoom + 0.2, 3));
                                    }}
                                    aria-label="Aumentar zoom"
                                >
                                    <i className="fas fa-search-plus"></i>
                                </button>
                                <button
                                    className="bg-white p-2 rounded-full shadow hover:bg-gray-200 focus:outline-none"
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        setCurrentZoom((prevZoom) => Math.max(prevZoom - 0.2, 1));
                                    }}
                                    aria-label="Diminuir zoom"
                                >
                                    <i className="fas fa-search-minus"></i>
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Seção Inferior Condicional */}
                    {activeTab === 'historia' && (
                        <>
                            {showAllStories ? (
                                <div className="w-full fixed bottom-0 left-0 py-2 m-0">
                                    <div className="w-full lg:py-8 flex justify-center">
                                        <button
                                            onClick={() => setShowAllStories(false)}
                                            className="w-[90%] bg-[#8A5A44] text-white py-2 px-4 rounded-md hover:bg-[#D8A568] focus:outline-none"
                                        >
                                            Ver Linha do Tempo
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <div className="w-full fixed bottom-0 left-0 m-0">
                                    <div className="w-full lg:py-4">
                                        <div className="border border-black p-2 mb-2 sm:mb-0 lg:mb-8 rounded-md bg-[#f5f1e8]">
                                            <p className="text-center text-lg font-bold -mb-4">
                                                Ano <strong>{currentHistory.ano}</strong>
                                            </p>

                                            <div className="flex items-center space-x-4 justify-center">
                                                <button
                                                    onClick={handlePrev}
                                                    className="p-2 bg-[#8A5A44] text-white rounded-full hover:bg-[#D8A568] focus:outline-none"
                                                    disabled={currentIndex === 0}
                                                    aria-label="História Anterior"
                                                >
                                                    <i className="fas fa-chevron-left"></i>
                                                </button>

                                                <input
                                                    type="range"
                                                    min={0}
                                                    max={historiasDaRua.length - 1}
                                                    value={currentIndex}
                                                    onChange={handleRangeChange}
                                                    className="w-1/2"
                                                    step="1"
                                                    aria-label="Selecionar história"
                                                />

                                                <button
                                                    onClick={handleNext}
                                                    className="p-2 bg-[#8A5A44] text-white rounded-full hover:bg-[#D8A568] focus:outline-none"
                                                    disabled={currentIndex === historiasDaRua.length - 1}
                                                    aria-label="Próxima História"
                                                >
                                                    <i className="fas fa-chevron-right"></i>
                                                </button>
                                            </div>

                                            <p className="text-center text-sm -mt-2">
                                                História {currentIndex + 1} de {historiasDaRua.length}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </>
                    )}

                    {/* Banner da Organização */}
                    {currentHistory && org && (
                        <div
                            className="w-full flex items-center justify-center rounded-b-lg relative"
                            style={{ height: '128px', backgroundColor: org.cor }}
                        >
                            <span className="absolute top-2 right-2 text-white text-sm font-semibold">
                                História por:
                            </span>
                            <Link to="/referencias?section=orgs" className="flex items-center">
                                <img src={org.logo} alt={org.fantasia} className="h-32" />
                            </Link>
                        </div>
                    )}

                    {/* Carrossel de Locais Recomendados */}
                    <div className="p-2 w-full py-2">
                        <div className="flex items-center justify-between">
                            <h3 className="text-xl pb-2 md:text-2xl font-bold">Locais Recomendados</h3>
                            <button
                                onClick={() => setShowLocaisRecomendados(!showLocaisRecomendados)}
                                className="flex items-center text-blue-600"
                            >
                                {showLocaisRecomendados ? 'Ocultar' : 'Mostrar'}
                                <i className={`ml-1 fas fa-chevron-${showLocaisRecomendados ? 'up' : 'down'}`}></i>
                            </button>
                        </div>
                        {showLocaisRecomendados && (
                            <div className="w-full overflow-x-auto">
                                <div className="flex space-x-4 px-4">
                                    {negocios.map((negocio, index) => (
                                        <div
                                            key={index}
                                            className="border border-black min-w-[200px] bg-[#f5f1e8] p-2 rounded-lg shadow cursor-pointer flex-shrink-0 hover:shadow-lg transition-shadow duration-300"
                                        >
                                            <img
                                                src={negocio.foto || 'https://placehold.co/250x150'}
                                                alt={negocio.titulo}
                                                className="w-full h-32 object-cover rounded-lg mb-2"
                                                onClick={() => openModal({ url: negocio.foto })}
                                            />
                                            <h4 className="font-semibold mb-1">{negocio.titulo}</h4>
                                            <p className="text-sm text-gray-600 mb-2 flex items-center justify-between">
                                                {negocio.segmento}
                                                <a
                                                    href={negocio.link}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                    className="text-blue-600 hover:text-blue-800 flex items-center ml-auto"
                                                >
                                                    <svg
                                                        xmlns="http://www.w3.org/2000/svg"
                                                        className="h-4 w-4 mr-1"
                                                        fill="none"
                                                        viewBox="0 0 24 24"
                                                        stroke="currentColor"
                                                    >
                                                        <path
                                                            strokeLinecap="round"
                                                            strokeLinejoin="round"
                                                            strokeWidth="2"
                                                            d="M12 2c4.418 0 8 3.582 8 8 0 3.255-1.938 6.062-4.707 7.456L12 22l-3.293-4.544C6.938 16.062 5 13.255 5 10c0-4.418 3.582-8 8-8z"
                                                        />
                                                    </svg>
                                                    Ver no Google
                                                </a>
                                            </p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Botões Condicionais */}
                    {activeTab !== 'historia' && (
                        <div className="w-full py-2 md:py-4 mb-12 lg:mb-20">
                            <button
                                onClick={() => changeTab('historia')}
                                className="w-full bg-[#8A5A44] text-white py-2 px-4 rounded-md hover:bg-[#D8A568] focus:outline-none"
                            >
                                Ver histórias dessa rua
                            </button>
                        </div>
                    )}

                    {activeTab === 'historia' && !showAllStories && (
                        <div className="w-full py-2 md:py-4 mb-12 lg:mb-20">
                            <button
                                onClick={() => setShowAllStories(true)}
                                className="w-full bg-[#8A5A44] text-white py-2 px-4 rounded-md hover:bg-[#D8A568] focus:outline-none"
                            >
                                Todas Histórias desta rua
                            </button>
                        </div>
                    )}
                </div>
            );
        };


        // Componente Legado Africano (Atualizado)
        const LegadoAfricano = () => {
            useEffect(() => {
                document.title = "Legado Afro-brasileiro e Indígena - Historin";

                // Atualizar a meta descrição
                let metaDescription = document.querySelector('meta[name="description"]');
                if (metaDescription) {
                    metaDescription.setAttribute('content', 'Descubra a história do legado afro-brasileiro e indígena em Gramado e como esses povos contribuíram para a cultura e formação da cidade.');
                } else {
                    metaDescription = document.createElement('meta');
                    metaDescription.name = "description";
                    metaDescription.content = 'Descubra a história do legado afro-brasileiro e indígena em Gramado e como esses povos contribuíram para a cultura e formação da cidade.';
                    document.head.appendChild(metaDescription);
                }
            }, []);

            // IDs das histórias selecionadas manualmente
            const selectedStoryIds = [49, 50, 51]; // Substitua pelos IDs reais

            // Filtrar as histórias com base nos IDs selecionados
            const historiasLegadoAfricano = historias.filter(historia => selectedStoryIds.includes(historia.id));

            return (
                <div className="p-4 w-full lg:w-4/5">
                    <header className="flex justify-between items-center mb-4">
                        <div className="text-2xl cursor-pointer">
                            <Link to="/">
                                <i className="fas fa-arrow-left"></i>
                            </Link>
                        </div>
                        <h1 className="text-lg font-bold">Legado Afro-brasileiro e Indígena</h1>
                        <div className="w-10 h-10"></div>

                    </header>

                    {/* Seção de Introdução */}
                    <section className="mb-6">
                        <h2 className="text-center text-xl font-bold mb-4">A Importância da Inclusão Histórica</h2>
                        <p className="text-justify">
                            Gramado, como muitas cidades do sul do Brasil, é amplamente reconhecida por sua herança europeia, principalmente alemã, italiana e portuguesa. Essas histórias são constantemente celebradas e lembradas, porém, a história dos negros afro-brasileiros na região muitas vezes permanece invisibilizada. Essa página é dedicada a dar voz àqueles que foram fundamentais na construção da cidade, mas cujas histórias foram apagadas ou esquecidas ao longo do tempo. O projeto Historin busca corrigir essa lacuna, destacando a importância de refletirmos sobre a diversidade de etnias que ajudaram a moldar nossa cidade, indo além das narrativas tradicionais.
                        </p>

                        {/* Espaço para Imagem */}
                        <div className="my-4 text-center">
                            <img
                                src="https://www.correiodopovo.com.br/image/contentid/policy:1.381579:1674812867/consciencia.jpg?a=2%3A1&w=680&$p$a$w=7f2aaba"
                                alt="Imagem ilustrativa sobre o legado afro-brasileiro"
                                className="rounded-lg shadow-lg object-cover w-full"
                            />
                            <p className="text-sm text-gray-600 mt-2">Imagem demonstra o trabalho de Afro-brasileiros na infraestrutura do RS</p>
                        </div>
                    </section>

                    {/* Seção sobre os Índios */}
                    <section className="mb-6">
                        <h3 className="text-lg font-bold mb-2">🌿 Povos Indígenas no Rio Grande do Sul e Gramado</h3>
                        <div className="border border-gray-300 rounded-lg p-4 bg-white">
                            <p className="text-justify mb-2">
                                Os povos indígenas, como os <strong>Kaingang</strong> e <strong>Guarani</strong>, foram os primeiros habitantes da região onde hoje se encontra o Rio Grande do Sul. Eles ocupavam a serra gaúcha muito antes da chegada dos colonizadores europeus.
                            </p>
                            <p className="text-justify mb-2">
                                Em Gramado, sua presença é sentida através de toponímias como Caí, Taquara, Quilombo, pampa entre outros práticas agrícolas e na profunda conexão com a natureza local. Vivendo em áreas ao redor de rios e florestas, esses povos praticavam caça, coleta e agricultura de subsistência, com destaque para o cultivo de milho e mandioca.
                            </p>
                            <p className="text-justify">
                                Com a chegada dos colonizadores, conflitos surgiram, resultando na expulsão ou exterminação de muitos indígenas. Embora suas histórias tenham sido silenciadas ao longo do tempo, elas continuam presentes na cultura local e merecem ser lembradas.
                            </p>
                        </div>
                    </section>

                    {/* Seção sobre a População Negra */}
                    <section className="mb-6">
                        <h3 className="text-lg font-bold mb-2">🖤 Afro-brasileiros e sua Contribuição em Gramado</h3>
                        <div className="border border-gray-300 rounded-lg p-4 bg-white">
                            <p className="text-justify mb-2">
                                A história dos afro-brasileiros em Gramado, embora menos conhecida, é de extrema importância. Durante os períodos colonial e imperial, negros escravizados foram trazidos para a região para trabalhar em plantações, construção de estradas, e outros serviços essenciais. A contribuição desses homens e mulheres foi fundamental para o desenvolvimento das infraestruturas iniciais da cidade.
                            </p>
                            <p className="text-justify mb-2">
                                O trabalho dos negros escravizados foi decisivo na construção de estradas, edificações e no desenvolvimento agrícola da região. Apesar disso, suas histórias foram sendo sistematicamente apagadas ou esquecidas. O Historin visa recuperar e dar visibilidade a essas contribuições, incluindo a presença e o legado afro-brasileiro na memória histórica de Gramado.
                            </p>
                            <p className="text-justify">
                                Gramado reconhece a necessidade de divulgar as histórias e as contribuições culturais e históricas dos afro-brasileiros na formação da cidade, desde o trabalho nas fazendas da Linha Caboclo até as construções e serviços domésticos que moldaram parte significativa da infraestrutura local.
                            </p>
                        </div>
                    </section>

                    {/* Explicação sobre o Artigo Completo */}
                    <div className="text-justify mb-4">
                        <p>
                            O artigo "A Invisibilidade dos Negros na História de Gramado" de Alex Juarez Müller e Raimundo Nonato Wanderley de Souza Cavalcante, publicado na revista "Em Tempo de Histórias", faz um levantamento preliminar sobre a participação dos afro-brasileiros na história de Gramado. Ele destaca a invisibilização histórica dessa população e a ausência de estudos acadêmicos que abordem o tema, buscando recuperar essas memórias essenciais para uma compreensão mais ampla da história local.
                        </p>
                    </div>

                    {/* Botão para o Artigo Completo */}
                    <div className="text-center mb-6">
                        <a
                            href="https://periodicos.unb.br/index.php/emtempos/article/view/31760/26500"
                            target="_blank"
                            rel="noopener noreferrer"
                            className="bg-blue-500 text-white px-6 py-3 rounded-md hover:bg-blue-600 transition"
                        >
                            Leia o Artigo Completo
                        </a>
                    </div>

                    {/* Seção de Histórias Selecionadas */}
                    <section className="mb-6">
                        <h3 className="text-lg font-bold mb-4">📚 Histórias Selecionadas</h3>
                        <div className="space-y-4">
                            {historiasLegadoAfricano.map(historia => (
                                <div
                                    key={historia.id}
                                    className="bg-white p-4 rounded-lg shadow mb-2 block hover:shadow-lg transition-shadow duration-300 w-full"
                                >
                                    <div className="flex flex-col md:flex-row">
                                        <img
                                            src={historia.fotos[0] || 'https://placehold.co/150x150'}
                                            alt={historia.titulo}
                                            className="rounded-lg mb-4 md:mb-0 md:mr-4 w-full md:w-1/3 object-cover"
                                        />
                                        <div className="flex-grow">
                                            <h3 className="font-semibold text-lg mb-2">{historia.titulo}</h3>
                                            <p className="text-sm text-gray-600 mb-2">{historia.descricao}</p> {/* Mostrar a descrição completa */}
                                            <p className="text-sm text-gray-600 flex items-center">
                                                <span className="mr-4">Ano: {historia.ano}</span>
                                                <Link
                                                    to={`/rua/${historia.rua_id}`}
                                                    className="text-blue-500 hover:underline"
                                                >
                                                    Ver na rua
                                                </Link>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </section>

                </div>
            );
        };





        // Página de Rua e História (Atualizado)
        const RuaHistoria = () => {
            const { id, historiaId } = useParams();
            const history = useHistory();
            const location = useLocation();
            const [currentHistory, setCurrentHistory] = useState(null);
            const [historiasDaRua, setHistoriasDaRua] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [showAllStories, setShowAllStories] = useState(false);
            const [selectedCityId, setSelectedCityId] = useState(null);
            const [filteredRuas, setFilteredRuas] = useState([]);
            const [activeTab, setActiveTab] = useState('historia');

            // Supondo que 'cidades', 'ruas' e 'historias' estão disponíveis globalmente via 'bd.js'
            const rua = ruas.find(r => r.id === parseInt(id)) || {};
            const cidade = cidades.find(c => c.id === rua.cidade_id) || {};

            // Função para atualizar as meta tags
            const updateMetaTags = (description, imageUrl) => {
                let metaDescription = document.querySelector('meta[name="description"]');
                if (metaDescription) {
                    metaDescription.setAttribute('content', description);
                } else {
                    metaDescription = document.createElement('meta');
                    metaDescription.name = "description";
                    metaDescription.content = description;
                    document.head.appendChild(metaDescription);
                }

                // Atualizar imagem meta
                let metaImage = document.querySelector('meta[property="og:image"]');
                if (metaImage) {
                    metaImage.setAttribute('content', imageUrl);
                } else {
                    metaImage = document.createElement('meta');
                    metaImage.setAttribute('property', 'og:image');
                    metaImage.setAttribute('content', imageUrl);
                    document.head.appendChild(metaImage);
                }
            };

            // Atualiza o título e as meta tags conforme a aba ativa
            useEffect(() => {
                if (activeTab === 'historia' && currentHistory) {
                    const cidadeNome = cidade.nome || "Cidade Desconhecida";
                    document.title = `${currentHistory.titulo} - ${cidadeNome}`;
                    updateMetaTags(currentHistory.descricao, currentHistory.fotos?.[0] || 'default-image-url');
                } else if (activeTab === 'rua') {
                    document.title = `A história da ${rua.nome || "Rua Desconhecida"} - ${cidade.nome || "Cidade Desconhecida"}`;
                    updateMetaTags(rua.descricao, rua.fotos?.[0] || 'default-image-url');
                } else if (activeTab === 'cidade') {
                    document.title = `A história da cidade de ${cidade.nome || "Cidade Desconhecida"}`;
                    updateMetaTags(cidade.descricao, cidade.foto || 'default-image-url');
                }
            }, [currentHistory, cidade, rua, selectedCityId, activeTab]);

            // Lê a aba ativa a partir dos parâmetros de query na URL
            useEffect(() => {
                const params = new URLSearchParams(location.search);
                const tab = params.get('tab') || 'historia';
                setActiveTab(tab);
            }, [location.search]);

            // Atualiza os dados da história com base no ID da rua e da história
            useEffect(() => {
                if (rua) {
                    const historiasList = historias.filter(h => h.rua_id === rua.id).sort((a, b) => a.ano - b.ano || a.id - b.id);
                    setHistoriasDaRua(historiasList);

                    if (historiaId) {
                        const historia = historiasList.find(h => h.id === parseInt(historiaId));
                        if (historia) {
                            setCurrentHistory(historia);
                            const index = historiasList.findIndex(h => h.id === historia.id);
                            setCurrentIndex(index);
                        }
                    } else if (historiasList.length > 0) {
                        const primeiraHistoria = historiasList[0];
                        setCurrentHistory(primeiraHistoria);
                        setCurrentIndex(0);
                        history.replace(`/rua/${id}/historia/${primeiraHistoria.id}`);
                    }
                    setSelectedCityId(rua.cidade_id);
                }
            }, [id, historiaId, history, rua, historias]);

            // Filtra ruas com base na cidade selecionada
            useEffect(() => {
                const filtered = selectedCityId ? ruas.filter(r => r.cidade_id === selectedCityId) : ruas;
                setFilteredRuas(filtered);
            }, [selectedCityId, ruas]);

            // Verifica se a rua selecionada está nas ruas filtradas
            useEffect(() => {
                const selectedRuaInFiltered = filteredRuas.find(r => r.id === parseInt(id));
                if (!selectedRuaInFiltered && filteredRuas.length > 0) {
                    history.push(`/rua/${filteredRuas[0].id}`);
                }
            }, [filteredRuas, id, history]);

            const handleRuaClick = (rua) => {
                history.push(`/rua/${rua.id}`);
            };

            const handleCityClick = (cidade) => {
                setSelectedCityId(cidade.id);
            };

            // Função para alterar a aba ativa e atualizar a URL
            const changeTab = (tab) => {
                setActiveTab(tab);
                const params = new URLSearchParams(location.search);
                if (tab === 'historia') {
                    params.delete('tab');
                } else {
                    params.set('tab', tab);
                }
                history.push({
                    pathname: location.pathname,
                    search: params.toString(),
                });
            };

            return (
                <main className="w-full lg:w-4/5 flex flex-col items-center flex-grow overflow-y-auto p-2">
                    <CityCarousel cidades={cidades} handleCityClick={handleCityClick} selectedCityId={selectedCityId} />
                    <RuaCarousel ruas={filteredRuas} handleRuaClick={handleRuaClick} selectedRuaId={parseInt(id)} />
                    <HistoriaContent
                        currentHistory={currentHistory}
                        historiasDaRua={historiasDaRua}
                        currentIndex={currentIndex}
                        setCurrentIndex={setCurrentIndex}
                        setCurrentHistory={setCurrentHistory}
                        showAllStories={showAllStories}
                        setShowAllStories={setShowAllStories}
                        selectedRuaId={parseInt(id)}
                        activeTab={activeTab}
                        changeTab={changeTab}
                        rua={rua}
                        cidade={cidade}
                        orgs={orgs} // Passando 'orgs' como prop
                        negocios={negocios} // Passando 'negocios' como prop, assumindo que também está definido
                    />
                </main>
            );
        };


        // não encontrado 404
        const NotFound = () => {
            return (
                <div className="p-4">
                    <h1 className="text-3xl font-bold text-center">404 - Página Não Encontrada</h1>
                    <p className="text-center">Desculpe, a página que você está procurando não existe.</p>
                    <div className="flex justify-center mt-4">
                        <Link to="/" className="bg-blue-500 text-white px-4 py-2 rounded-md">
                            Voltar para Home
                        </Link>
                    </div>
                </div>
            );
        };

        // Componente FeedbackPopup
        const FeedbackPopup = ({ isOpen, onClose }) => {
            if (!isOpen) return null;

            const [formData, setFormData] = useState({
                nome: '',
                email: '',
                comentario: '',
                estrelas: 0
            });

            const handleChange = (e) => {
                const { id, value } = e.target;
                setFormData({ ...formData, [id]: value });
            };

            const handleStarClick = (starValue) => {
                setFormData({ ...formData, estrelas: starValue });
            };

            return (
                <div className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-high" onClick={onClose}>
                    <div
                        className="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative"
                        onClick={(e) => e.stopPropagation()} // Evita fechar ao clicar dentro do modal
                    >
                        {/* Botão de Fechar */}
                        <button
                            className="absolute top-2 right-2 text-gray-600 hover:text-gray-800"
                            onClick={onClose}
                            aria-label="Fechar formulário de feedback"
                        >
                            <i className="fas fa-times text-xl"></i>
                        </button>
                        <h3 className="text-xl font-bold mb-4 text-center">Envie seu Feedback</h3>

                        <p className="text-gray-600 text-center mb-4">
                            Estamos em fase inicial da nossa plataforma e sua opinião é muito importante para nós! Por favor, avalie-nos ajude a melhorar.
                        </p>

                        <form action="https://formspree.io/f/manywvne" method="POST">
                            {/* Avaliação com Estrelas */}
                            <div className="mb-4 text-center">
                                <label className="block text-gray-700 text-sm font-bold mb-2">
                                    Avaliação:
                                </label>
                                <div className="flex justify-center mb-2">
                                    {[1, 2, 3, 4, 5].map((star) => (
                                        <button
                                            key={star}
                                            type="button"
                                            onClick={() => handleStarClick(star)}
                                            className={`text-3xl ${formData.estrelas >= star ? 'text-yellow-400' : 'text-gray-300'}`}
                                        >
                                            ★
                                        </button>
                                    ))}
                                </div>
                                <p className="text-gray-500 text-sm">Sua avaliação: {formData.estrelas} estrela(s)</p>
                                <input type="hidden" name="estrelas" value={formData.estrelas} />
                            </div>

                            {/* Nome opcional */}
                            <div className="mb-4">
                                <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="nome">
                                    Nome (opcional):
                                </label>
                                <input
                                    className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                    id="nome"
                                    type="text"
                                    name="nome"
                                    placeholder="Seu nome"
                                    value={formData.nome}
                                    onChange={handleChange}
                                />
                            </div>

                            {/* Email opcional */}
                            <div className="mb-4">
                                <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="email">
                                    E-mail (opcional):
                                </label>
                                <input
                                    className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                    id="email"
                                    type="email"
                                    name="email"
                                    placeholder="Seu e-mail"
                                    value={formData.email}
                                    onChange={handleChange}
                                />
                            </div>

                            {/* Comentário obrigatório */}
                            <div className="mb-4">
                                <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="comentario">
                                    Comentário:
                                </label>
                                <textarea
                                    className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                    id="comentario"
                                    name="comentario"
                                    rows="4"
                                    placeholder="Escreva seu feedback sobre a plataforma"
                                    value={formData.comentario}
                                    onChange={handleChange}
                                    required
                                ></textarea>
                            </div>

                            <div className="flex items-center justify-center">
                                <button
                                    type="submit"
                                    className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                                >
                                    Enviar Feedback
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };


        function App() {
            const [menuOpen, setMenuOpen] = useState(false);
            const [showMap, setShowMap] = useState(true);
            const [previewContent, setPreviewContent] = useState(null);
            const [selectedRuaId, setSelectedRuaId] = useState(null);
            const [showPopup, setShowPopup] = useState(false);
            const location = useLocation(); // useLocation hook
            const [showFeedback, setShowFeedback] = useState(false);
            const [showSteps, setShowSteps] = useState(false);

            // Estados para os pop-ups
            const [showOnboarding, setShowOnboarding] = useState(false);
            const [showDonation, setShowDonation] = useState(false);

            // Referência para rastrear o estado atual dos popups
            const popupsRef = useRef({
                showOnboarding: false,
                showPopup: false,
                showFeedback: false,
                showDonation: false,
            });

            // Atualizar a referência sempre que algum estado de popup mudar
            useEffect(() => {
                popupsRef.current = {
                    showOnboarding,
                    showPopup,
                    showFeedback,
                    showDonation,
                };
            }, [showOnboarding, showPopup, showFeedback, showDonation]);

            // Mapeando ruas com uma imagem aleatória das histórias associadas
            const ruasWithImages = useMemo(() => {
                return ruas.map(rua => {
                    const historiasDaRua = historias.filter(historia => historia.rua_id === rua.id);
                    const fotos = historiasDaRua.flatMap(historia => historia.fotos);
                    const randomFoto = fotos.length > 0 ? fotos[Math.floor(Math.random() * fotos.length)] : null;
                    return { ...rua, fotos: randomFoto };
                });
            }, [ruas, historias]);

            const handlePreviewClose = () => {
                setPreviewContent(null);
            };

            // Variáveis para a homepage
            const filteredRuasWithImages = useMemo(() => {
                return ruasWithImages.slice(0, 4);
            }, [ruasWithImages]);

            // IDs das histórias mais vistas
            const mostViewedIds = [41, 5, 10, 21];

            // Filtre as histórias com base nos IDs definidos
            const filteredHistorias = useMemo(() => {
                return historias.filter(historia => mostViewedIds.includes(historia.id));
            }, [historias]);

            // Função para lidar com cliques em ruas a partir da home
            const handleRuaClick = (rua) => {
                setSelectedRuaId(rua.id);
                setPreviewContent({
                    title: rua.nome,
                    description: rua.descricao,
                    images: historias.filter(h => h.rua_id === rua.id).flatMap(h => h.fotos)
                });
            };

            // Função para lidar com cliques em histórias a partir da home
            const handleHistoriaClick = (historia) => {
                setSelectedRuaId(historia.rua_id);
                setPreviewContent({
                    title: historia.titulo,
                    description: historia.descricao,
                    images: historia.fotos
                });
            };

            useEffect(() => {
                // Onboarding Popup: Mostrar apenas na primeira visita
                const hasVisited = localStorage.getItem('hasVisited');
                if (!hasVisited) {
                    const onboardingTimer = setTimeout(() => {
                        setShowOnboarding(true);
                        localStorage.setItem('hasVisited', 'true');
                    }, 2000); // 2 segundos após o carregamento

                    return () => clearTimeout(onboardingTimer);
                }

                // Donation Popup: Mostrar após 3 minutos se nenhum outro popup estiver aberto
                const donationTimer = setTimeout(() => {
                    if (
                        !popupsRef.current.showOnboarding &&
                        !popupsRef.current.showPopup &&
                        !popupsRef.current.showFeedback
                    ) {
                        setShowDonation(true);
                    }
                }, 180000); // 3 minutos

                return () => clearTimeout(donationTimer);
            }, []);

            useEffect(() => {
                // Popup Carrossel: Mostrar após 1 minuto se a condição for satisfeita
                if (shouldShowPopup()) {
                    const popupTimer = setTimeout(() => {
                        setShowPopup(true);
                    }, 60000); // 60 segundos

                    return () => clearTimeout(popupTimer);
                }
            }, []);

            useEffect(() => {
                // Feedback Popup: Mostrar automaticamente após 5 minutos se nenhum outro popup estiver aberto
                const feedbackTimer = setTimeout(() => {
                    if (
                        !popupsRef.current.showOnboarding &&
                        !popupsRef.current.showPopup &&
                        !popupsRef.current.showDonation
                    ) {
                        setShowFeedback(true);
                    }
                }, 300000); // 5 minutos

                return () => clearTimeout(feedbackTimer);
            }, []);

            useEffect(() => {
                // Set default title and meta description for the home page
                if (location.pathname === "/" || location.pathname === "/#") {
                    document.title = "Historin História da cidades - Ínicio";
                    let metaDescription = document.querySelector('meta[name="description"]');
                    if (metaDescription) {
                        metaDescription.setAttribute('content', 'Descubra as histórias de Gramado através do Historin. Explore ruas, conheça eventos marcantes e contribua com suas próprias histórias.');
                    } else {
                        metaDescription = document.createElement('meta');
                        metaDescription.name = "description";
                        metaDescription.content = 'Descubra as histórias de Gramado através do Historin. Explore ruas, conheça eventos marcantes e contribua com suas próprias histórias.';
                        document.head.appendChild(metaDescription);
                    }
                }
            }, [location.pathname]);

            // Adicionado no início do componente App
            const prevLocation = useRef(location);

            useEffect(() => {
                // Comparar a localização atual com a anterior
                if (location.pathname !== prevLocation.current.pathname || location.search !== prevLocation.current.search) {
                    // Atualizar a localização anterior
                    prevLocation.current = location;

                    // Obter o caminho da rota atual
                    const pagePath = location.pathname + location.search;

                    // Evitar enviar 'page_view' para '/#'
                    if (pagePath === '/#') return;

                    // Enviar o evento de visualização de página para o GA4
                    window.gtag('event', 'page_view', {
                        page_title: document.title,
                        page_path: pagePath,
                    });
                }
            }, [location]);

            return (
                <div className="font-roboto bg-[#F4ECE1] text-[#3E3A33] min-h-screen flex flex-col">
                    <Menu menuOpen={menuOpen} setMenuOpen={setMenuOpen} setShowMap={setShowMap} />

                    <Header setMenuOpen={setMenuOpen} setShowFeedback={setShowFeedback} />

                    {/* Renderizar popups condicionais */}
                    {showPopup && <PopupCarrossel onClose={() => setShowPopup(false)} />}
                    {showOnboarding && <OnboardingPopup onClose={() => setShowOnboarding(false)} />}
                    {showDonation && <DonationPopup onClose={() => setShowDonation(false)} />}
                    {showFeedback && <FeedbackPopup isOpen={showFeedback} onClose={() => setShowFeedback(false)} />}

                    <Switch>
                        <Route path="/sobre" component={Sobre} />
                        <Route path="/referencias" component={Referencias} />
                        <Route path="/adicionar-historia" component={AdicionarHistoria} />
                        <Route path="/ruas-e-historias" component={RuasEHistorias} />
                        <Route path="/legado-africano" component={LegadoAfricano} />
                        <Route path="/rua/:id/historia/:historiaId" component={RuaHistoria} />
                        <Route path="/rua/:id" component={RuaHistoria} />
                        <Route exact path="/">
                            {showMap ? (
                                <div className="w-full lg:w-4/5 relative">
                                    <MapView setSelectedRuaId={setSelectedRuaId} setPreviewContent={setPreviewContent} />
                                    {previewContent && (
                                        <Preview previewContent={previewContent} onClose={handlePreviewClose} selectedRuaId={selectedRuaId} />
                                    )}

                                    <div className="introduction p-4">
                                        <h2>Bem-vindo ao Historin!</h2>
                                        <button
                                            onClick={() => setShowSteps(!showSteps)}
                                            className="flex items-center justify-between mt-2 ml-auto"
                                        >
                                            <span>Ver mais</span>
                                            <svg
                                                className={`w-6 h-6 transform transition-transform ${showSteps ? 'rotate-180' : 'rotate-0'}`}
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </button>

                                        {showSteps && (
                                            <div className="steps mt-4">
                                                <div className="step">
                                                    <span className="step-number">1</span>
                                                    <p>Explore histórias pela geografia e descubra a história por trás dos lugares!</p>
                                                </div>
                                                <div className="step">
                                                    <span className="step-number">2</span>
                                                    <p>Navegue pela linha do tempo para reviver os eventos que moldaram nossa cidade!</p>
                                                </div>
                                                <div className="step">
                                                    <span className="step-number">3</span>
                                                    <p>Contribua com suas histórias e experiências e aproveite a jornada!</p>
                                                </div>
                                            </div>
                                        )}
                                    </div>


                                    {/* Seção de Ruas Recomendadas */}
                                    <div className="px-4">
                                        <div className="flex justify-between items-center mb-2">
                                            <h2 className="text-lg font-semibold">Ruas Recomendadas</h2>
                                            <Link to="/ruas-e-historias">
                                                <button className="text-sm text-[#8A5A44] hover:underline">
                                                    Ver tudo
                                                </button>
                                            </Link>
                                        </div>

                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            {filteredRuasWithImages.map(rua => (
                                                <Link
                                                    key={rua.id}
                                                    to={`/rua/${rua.id}`}
                                                    className="bg-white p-2 rounded-lg shadow cursor-pointer block hover:shadow-lg transition-shadow duration-300"
                                                >
                                                    <img src={rua.fotos || 'https://placehold.co/300x200'} alt={rua.nome} className="rounded-lg mb-2 w-full h-40 object-cover" />
                                                    <h3 className="font-semibold">{rua.nome}</h3>
                                                </Link>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Seção de Histórias Mais Vistas */}
                                    <div className="px-4 mt-6">
                                        <div className="flex justify-between items-center mb-2">
                                            <h2 className="text-lg font-semibold">Histórias Mais Vistas</h2>
                                            <Link to="/ruas-e-historias">
                                                <button className="text-sm text-[#8A5A44] hover:underline">
                                                    Ver tudo
                                                </button>
                                            </Link>
                                        </div>
                                        {filteredHistorias.map(historia => (
                                            <Link
                                                key={historia.id}
                                                to={`/rua/${historia.rua_id}/historia/${historia.id}`}
                                                className="bg-white p-2 rounded-lg shadow mb-2 flex items-center cursor-pointer block hover:shadow-lg transition-shadow duration-300"
                                            >
                                                <img src={historia.fotos[0] || 'https://placehold.co/100x100'} alt={historia.titulo} className="rounded-lg mr-2 w-24 h-24 object-cover" />
                                                <div>
                                                    <h3 className="font-semibold">{historia.titulo}</h3>
                                                    <p className="text-sm text-gray-600">{historia.descricao.slice(0, 60)}...</p>
                                                </div>
                                            </Link>
                                        ))}

                                        <LegadoAfricanoCard />

                                        <div className="px-4 mt-8">
                                            <div className="bg-white p-6 rounded-lg shadow-md flex flex-col md:flex-row items-center">
                                                <img loading="lazy" src="https://i.imgur.com/nav9mZa.jpeg" alt="Informações sobre a plataforma" className="w-full md:w-1/3 rounded-lg mb-4 md:mb-0 md:mr-6 object-cover" />
                                                <div>
                                                    <h2 className="text-xl font-bold mb-2">Estamos só começando!</h2>
                                                    <p className="text-gray-700 mb-4">
                                                        O Historin é mais do que uma plataforma de histórias. Nossa jornada está apenas começando, e em breve, traremos uma experiência imersiva com <strong>Realidade Aumentada</strong>. QR codes serão espalhados pelas ruas de Gramado, permitindo a todos explorar a história de maneira interativa, conectando o passado e o presente de forma inovadora. Fique atento às novidades!
                                                    </p>
                                                    <Link
                                                        to="/sobre"
                                                        className="bg-blue-500 text-white px-6 py-3 rounded-md hover:bg-blue-600 transition"
                                                    >
                                                        Saiba mais sobre o Historin
                                                    </Link>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            ) : (
                                <RuaHistoria />
                            )}
                        </Route>
                        <Route component={NotFound} />
                    </Switch>

                    {/* Rodapé Fixo para Computadores */}
                    <footer className="fixed-footer">
                        <p>Essa aplicação funciona melhor em dispositivos móveis</p>
                    </footer>
                </div>
            );
        }

        // Renderização do App Envolto pelo HashRouter
        ReactDOM.render(
            <HashRouter>
                <App />
            </HashRouter>,
            document.getElementById('root')
        );
    </script>

</body>

</html>